"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[699],{4699:(Y,y,d)=>{d.r(y),d.d(y,{ArmoryComponent:()=>U});var C=d(467),f=d(2200),u=d(4341),E=d(7556),p=d(3757),e=d(3664),g=d(2615),k=d(4384);const x=i=>({toggled:i});function M(i,m){if(1&i){const t=e.RV6();e.j41(0,"app-single-item",7),e.bIt("craftItem",function(o){g.eBV(t);const r=e.XpG(2);return g.Njj(r.craft(o))}),e.k0s()}if(2&i){const t=m.$implicit,n=e.XpG(2);e.Y8G("item",t)("toggled",n.areRequiredItemsToggled)("unlockedItemIds",n.unlockedItemIds)}}function $(i,m){if(1&i&&(e.j41(0,"div",5),e.DNE(1,M,1,3,"app-single-item",6),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.getRequiredItems())}}let j=(()=>{class i{itemLoaderService;item;unlockedItemIds;toggled;craftItem=new e.bkB;areRequiredItemsToggled=!1;constructor(t){this.itemLoaderService=t}getItemSrc(t){let n=t.name.toLocaleLowerCase();n=n.replaceAll(" ","-");let o=t.id.toString().padStart(3,"00");return this.isItemLocked()?"./images/fh/items/item-back-fh.png":`./images/items/fh-${o}-${n}.jpeg`}isItemLocked(){return this.unlockedItemIds?.indexOf(this.item.id)<0}getItemResources(){return this.item.resources?Object.keys(this.item.resources):void 0}craft(t){this.areRequiredItemsToggled=!this.areRequiredItemsToggled,this.craftItem.emit(t||this.item)}hasRequiredItems(){return this.item.requiredItems&&this.item.requiredItems.length>0}getRequiredItems(){return this.item.requiredItems?.length>0?this.itemLoaderService.getUnlockedItems(this.item.requiredItems):[]}static \u0275fac=function(n){return new(n||i)(e.rXU(k.y))};static \u0275cmp=e.VBU({type:i,selectors:[["app-single-item"]],hostBindings:function(n,o){1&n&&e.bIt("click",function(l){return l.stopPropagation()})},inputs:{item:"item",unlockedItemIds:"unlockedItemIds",toggled:"toggled"},outputs:{craftItem:"craftItem"},decls:6,vars:7,consts:[[1,"container"],[1,"item",3,"click"],[1,"id"],[3,"src"],["class","required-items",4,"ngIf"],[1,"required-items"],[3,"item","toggled","unlockedItemIds","craftItem",4,"ngFor","ngForOf"],[3,"craftItem","item","toggled","unlockedItemIds"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(){return o.craft()}),e.j41(2,"div",2),e.EFF(3),e.k0s(),e.nrm(4,"img",3),e.k0s(),e.DNE(5,$,2,1,"div",4),e.k0s()),2&n&&(e.HbH(e.eq3(5,x,o.toggled||o.areRequiredItemsToggled)),e.R7$(3),e.JRh(o.item.id),e.R7$(),e.Y8G("src",o.getItemSrc(o.item),e.B4B),e.R7$(),e.Y8G("ngIf",o.toggled||o.areRequiredItemsToggled))},dependencies:[i,f.MD,f.Sq,f.bT,u.YN],styles:[".container[_ngcontent-%COMP%], .required-items[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:.3rem}.container.toggled[_ngcontent-%COMP%]{border:1px solid var(--font-color)}.item[_ngcontent-%COMP%]{position:relative;cursor:pointer}.item[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:10px}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:240px}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;gap:.3rem;flex-direction:column;right:0;top:0;justify-content:center}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--font-color)}.item[_ngcontent-%COMP%]   .required-items[_ngcontent-%COMP%]{position:absolute;width:3rem;height:6rem;top:25px;right:0}"]})}return i})();var b=d(4700),P=d(7473);function T(i,m){if(1&i&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme(" selected: ",t.selectedItem.name," - ",t.selectedItem.id," ")}}function G(i,m){if(1&i){const t=e.RV6();e.j41(0,"div",7),e.nrm(1,"div",8),e.j41(2,"input",9),e.mxI("ngModelChange",function(o){const r=g.eBV(t).$implicit,l=e.XpG();return e.DH7(l.inventory[r],o)||(l.inventory[r]=o),g.Njj(o)}),e.k0s()()}if(2&i){const t=m.$implicit,n=e.XpG();e.R7$(),e.HbH(t),e.R7$(),e.R50("ngModel",n.inventory[t])}}function L(i,m){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"app-single-item",16),e.bIt("craftItem",function(o){g.eBV(t);const r=e.XpG(3);return g.Njj(r.craftItem(o))}),e.k0s()()}if(2&i){const t=m.$implicit,n=e.XpG(3);e.R7$(),e.Y8G("item",t)("unlockedItemIds",n.unlockedItemIds)}}function F(i,m){if(1&i&&(e.j41(0,"div",14),e.DNE(1,L,2,2,"div",15),e.k0s()),2&i){const t=e.XpG().$implicit,n=e.XpG();e.R7$(),e.Y8G("ngForOf",n.getSlotItems(t))}}function A(i,m){if(1&i){const t=e.RV6();e.j41(0,"div",10)(1,"div",11),e.bIt("click",function(){const o=g.eBV(t).$implicit,r=e.XpG();return g.Njj(r.toggleCategory(o))}),e.j41(2,"span",12),e.EFF(3),e.k0s(),e.EFF(4),e.k0s(),e.DNE(5,F,2,1,"div",13),e.k0s()}if(2&i){const t=m.$implicit,n=e.XpG();e.R7$(),e.AVh("clickable",!0),e.R7$(2),e.JRh(n.isExpanded(t)?"\u25be":"\u25b8"),e.R7$(),e.SpI(" ",t," "),e.R7$(),e.Y8G("ngIf",n.isExpanded(t))}}let U=(()=>{class i{itemLoaderService;db;notificationService;unlockedItemIds;slots=[...Object.values(p.o),"potions"];inventory={};all;head;body;legs;onehand;twohand;small;potions;RESOURCE_KEYS;selectedItem=null;expanded={};toggleCategory(t){this.expanded[t]=!this.expanded[t]}isExpanded(t){return!!this.expanded[t]}constructor(t,n,o){this.itemLoaderService=t,this.db=n,this.notificationService=o}ngOnInit(){var t=this;return(0,C.A)(function*(){yield t.loadUnlockedItems()})()}getSlotItems(t){return this[t]}loadUnlockedItems(){var t=this;return(0,C.A)(function*(){const n=yield t.db.getUnlockedItems();t.unlockedItemIds=n.map(o=>o.id),t.loadItems()})()}craftItem(t){this.selectedItem=t,this.printRequirements(t)}loadItems(){this.all=this.itemLoaderService.getUnlockedItems(this.unlockedItemIds),this.RESOURCE_KEYS=this.itemLoaderService.ALL_RESOURCE_KEYS;const n=r=>this.all.filter(l=>((r,l)=>r?.slot?.toLocaleLowerCase()===l.toLocaleLowerCase())(l,r));this.head=n(p.o.Head),this.body=n(p.o.Body),this.legs=n(p.o.Legs),this.onehand=n(p.o.Onehand),this.twohand=n(p.o.Twohand);const o=n(p.o.Small);this.potions=o.filter(r=>this.itemLoaderService.isPotion(r)),this.small=o.filter(r=>!this.itemLoaderService.isPotion(r));for(const r of this.slots)this.expanded[r]=!0}printRequirements(t){console.log("[armory] requirements for",t.id);const n=s=>(this.all??[]).find(c=>c.id===s),r=new Set,l=new Set,I=new Set,_={},R=s=>{if(r.has(s))return;r.add(s);const c=n(s);if(!c)return l.add(s),void I.add(s);const a={...c.resources??{}};"number"==typeof c.cost&&c.cost>0&&(a.gold=(a.gold??0)+c.cost),(s=>{if(s)for(const c of Object.keys(s)){const a=Number(s[c]??0);a>0&&(_[c]=(_[c]??0)+a)}})(a);const v=(s=>{const c=s?.requiredItems??s?.requires??s?.components??s?.dependsOn??[];return Array.isArray(c)?c.filter(a=>"number"==typeof a):[]})(c);for(const O of v)l.add(O),R(O)};R(t.id);for(const s of this.RESOURCE_KEYS)this.inventory[s]=Number(_[s]??0);const h=s=>n(s)?.name??`${s}`;console.log("--- REQUIREMENTS ---"),console.log(`Item: ${h(t.id)}`);let S=!1;console.log("Materials (incl. dependencies):");for(const s of this.RESOURCE_KEYS){const c=this.inventory[s]??0;c>0&&(S=!0,console.log(`  - ${s}: ${c}`))}if(S||console.log("  (none)"),l.size>0){console.log("Dependent items:");for(const s of l){const c=I.has(s)?"[LOCKED]":"[Unlocked]";console.log(`  - ${h(s)} (id: ${s}) ${c}`)}}else console.log("Dependent items: none");if(console.log("--------------------"),I.size>0){const s=Array.from(I).map(v=>`${h(v)}`).join(", "),a=`Cannot craft "${h(t.id)}" \u2014 ${s} locked.`;this.notificationService.emitErrorMessage(a)}else this.notificationService.emitInfoMessage("required materials loaded")}static \u0275fac=function(n){return new(n||i)(e.rXU(k.y),e.rXU(b.a),e.rXU(P.J))};static \u0275cmp=e.VBU({type:i,selectors:[["app-armory"]],decls:6,vars:3,consts:[[1,"content"],["class","selected",4,"ngIf"],[1,"filters"],["class","materials",4,"ngFor","ngForOf"],[1,"items-container"],["class","items-group",4,"ngFor","ngForOf"],[1,"selected"],[1,"materials"],[1,"icon"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"items-group"],[1,"title",3,"click"],[1,"chev"],["class","container",4,"ngIf"],[1,"container"],[4,"ngFor","ngForOf"],[3,"craftItem","item","unlockedItemIds"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.DNE(1,T,2,2,"div",1),e.j41(2,"div",2),e.DNE(3,G,3,3,"div",3),e.k0s()(),e.j41(4,"div",4),e.DNE(5,A,6,5,"div",5),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",o.selectedItem),e.R7$(2),e.Y8G("ngForOf",o.RESOURCE_KEYS),e.R7$(2),e.Y8G("ngForOf",o.slots))},dependencies:[f.MD,f.Sq,f.bT,u.YN,u.me,u.BC,u.vS,E.S,j],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3rem}.selected[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;margin-bottom:.5rem}.filters[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem}.filters[_ngcontent-%COMP%]   .materials[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-direction:row;align-items:center}@media (max-width: 768px){.container[_ngcontent-%COMP%]{justify-content:space-around}.filters[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{justify-content:center}}.title.clickable[_ngcontent-%COMP%]{cursor:pointer}.title.clickable[_ngcontent-%COMP%]:hover{opacity:.9}"]})}return i})()}}]);