"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[699],{4699:(A,y,l)=>{l.r(y),l.d(y,{ArmoryComponent:()=>U});var C=l(467),f=l(2200),u=l(4341),M=l(7556),g=l(3757),e=l(3664),p=l(2615),O=l(4384);const E=s=>({toggled:s});function j(s,m){if(1&s){const t=e.RV6();e.j41(0,"app-single-item",7),e.bIt("craftItem",function(o){p.eBV(t);const c=e.XpG(2);return p.Njj(c.craft(o))}),e.k0s()}if(2&s){const t=m.$implicit,n=e.XpG(2);e.Y8G("item",t)("toggled",n.areRequiredItemsToggled)("unlockedItemIds",n.unlockedItemIds)}}function $(s,m){if(1&s&&(e.j41(0,"div",5),e.DNE(1,j,1,3,"app-single-item",6),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.getRequiredItems())}}let b=(()=>{class s{itemLoaderService;item;unlockedItemIds;toggled;craftItem=new e.bkB;areRequiredItemsToggled=!1;constructor(t){this.itemLoaderService=t}getItemSrc(t){let n=t.name.toLocaleLowerCase();n=n.replaceAll(" ","-");let o=t.id.toString().padStart(3,"00");return this.isItemLocked()?"./images/fh/items/item-back-fh.png":`./images/items/fh-${o}-${n}.jpeg`}isItemLocked(){return this.unlockedItemIds?.indexOf(this.item.id)<0}getItemResources(){return this.item.resources?Object.keys(this.item.resources):void 0}craft(t){this.areRequiredItemsToggled=!this.areRequiredItemsToggled,this.craftItem.emit(t||this.item)}hasRequiredItems(){return this.item.requiredItems&&this.item.requiredItems.length>0}getRequiredItems(){return this.item.requiredItems?.length>0?this.itemLoaderService.getUnlockedItems(this.item.requiredItems):[]}static \u0275fac=function(n){return new(n||s)(e.rXU(O.y))};static \u0275cmp=e.VBU({type:s,selectors:[["app-single-item"]],hostBindings:function(n,o){1&n&&e.bIt("click",function(a){return a.stopPropagation()})},inputs:{item:"item",unlockedItemIds:"unlockedItemIds",toggled:"toggled"},outputs:{craftItem:"craftItem"},decls:6,vars:7,consts:[[1,"container"],[1,"item",3,"click"],[1,"id"],[3,"src"],["class","required-items",4,"ngIf"],[1,"required-items"],[3,"item","toggled","unlockedItemIds","craftItem",4,"ngFor","ngForOf"],[3,"craftItem","item","toggled","unlockedItemIds"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(){return o.craft()}),e.j41(2,"div",2),e.EFF(3),e.k0s(),e.nrm(4,"img",3),e.k0s(),e.DNE(5,$,2,1,"div",4),e.k0s()),2&n&&(e.HbH(e.eq3(5,E,o.toggled||o.areRequiredItemsToggled)),e.R7$(3),e.JRh(o.item.id),e.R7$(),e.Y8G("src",o.getItemSrc(o.item),e.B4B),e.R7$(),e.Y8G("ngIf",o.toggled||o.areRequiredItemsToggled))},dependencies:[s,f.MD,f.Sq,f.bT,u.YN],styles:[".container[_ngcontent-%COMP%], .required-items[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:.3rem}.container.toggled[_ngcontent-%COMP%]{border:1px solid var(--font-color)}.item[_ngcontent-%COMP%]{position:relative;cursor:pointer}.item[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:10px}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:240px}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;gap:.3rem;flex-direction:column;right:0;top:0;justify-content:center}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--font-color)}.item[_ngcontent-%COMP%]   .required-items[_ngcontent-%COMP%]{position:absolute;width:3rem;height:6rem;top:25px;right:0}"]})}return s})();var x=l(4700),P=l(7473);function T(s,m){if(1&s&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Lme(" selected: ",t.selectedItem.name," - ",t.selectedItem.id," ")}}function L(s,m){if(1&s){const t=e.RV6();e.j41(0,"div",7),e.nrm(1,"div",8),e.j41(2,"input",9),e.mxI("ngModelChange",function(o){const c=p.eBV(t).$implicit,a=e.XpG();return e.DH7(a.inventory[c],o)||(a.inventory[c]=o),p.Njj(o)}),e.k0s()()}if(2&s){const t=m.$implicit,n=e.XpG();e.R7$(),e.HbH(t),e.R7$(),e.R50("ngModel",n.inventory[t])}}function F(s,m){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"app-single-item",14),e.bIt("craftItem",function(o){p.eBV(t);const c=e.XpG(2);return p.Njj(c.craftItem(o))}),e.k0s()()}if(2&s){const t=m.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("item",t)("unlockedItemIds",n.unlockedItemIds)}}function G(s,m){if(1&s&&(e.j41(0,"div",10)(1,"div",11),e.EFF(2),e.k0s(),e.j41(3,"div",12),e.DNE(4,F,2,2,"div",13),e.k0s()()),2&s){const t=m.$implicit,n=e.XpG();e.R7$(2),e.JRh(t),e.R7$(2),e.Y8G("ngForOf",n.getSlotItems(t))}}let U=(()=>{class s{itemLoaderService;db;notificationService;unlockedItemIds;slots=Object.values(g.o);inventory={};all;head;body;legs;onehand;twohand;small;RESOURCE_KEYS;selectedItem=null;constructor(t,n,o){this.itemLoaderService=t,this.db=n,this.notificationService=o}ngOnInit(){var t=this;return(0,C.A)(function*(){yield t.loadUnlockedItems()})()}getSlotItems(t){return this[t]}loadUnlockedItems(){var t=this;return(0,C.A)(function*(){const n=yield t.db.getUnlockedItems();t.unlockedItemIds=n.map(o=>o.id),t.loadItems()})()}craftItem(t){this.selectedItem=t,this.printRequirements(t)}loadItems(){this.all=this.itemLoaderService.getUnlockedItems(this.unlockedItemIds),this.RESOURCE_KEYS=this.itemLoaderService.ALL_RESOURCE_KEYS,Object.entries({head:g.o.Head,body:g.o.Body,legs:g.o.Legs,onehand:g.o.Onehand,twohand:g.o.Twohand,small:g.o.Small}).forEach(([n,o])=>{this[n]=this.all.filter(c=>c?.slot?.toLocaleLowerCase()===o.toLocaleLowerCase())})}printRequirements(t){console.log("[armory] requirements for",t.id);const n=i=>(this.all??[]).find(r=>r.id===i),c=new Set,a=new Set,I=new Set,v={},R=i=>{if(c.has(i))return;c.add(i);const r=n(i);if(!r)return a.add(i),void I.add(i);const d={...r.resources??{}};"number"==typeof r.cost&&r.cost>0&&(d.gold=(d.gold??0)+r.cost),(i=>{if(i)for(const r of Object.keys(i)){const d=Number(i[r]??0);d>0&&(v[r]=(v[r]??0)+d)}})(d);const _=(i=>{const r=i?.requiredItems??i?.requires??i?.components??i?.dependsOn??[];return Array.isArray(r)?r.filter(d=>"number"==typeof d):[]})(r);for(const k of _)a.add(k),R(k)};R(t.id);for(const i of this.RESOURCE_KEYS)this.inventory[i]=Number(v[i]??0);const h=i=>n(i)?.name??`${i}`;console.log("--- REQUIREMENTS ---"),console.log(`Item: ${h(t.id)}`);let S=!1;console.log("Materials (incl. dependencies):");for(const i of this.RESOURCE_KEYS){const r=this.inventory[i]??0;r>0&&(S=!0,console.log(`  - ${i}: ${r}`))}if(S||console.log("  (none)"),a.size>0){console.log("Dependent items:");for(const i of a){const r=I.has(i)?"[LOCKED]":"[Unlocked]";console.log(`  - ${h(i)} (id: ${i}) ${r}`)}}else console.log("Dependent items: none");if(console.log("--------------------"),I.size>0){const i=Array.from(I).map(_=>`${h(_)}`).join(", "),d=`Cannot craft "${h(t.id)}" \u2014 ${i} locked.`;this.notificationService.emitErrorMessage(d)}else this.notificationService.emitInfoMessage("required materials loaded")}static \u0275fac=function(n){return new(n||s)(e.rXU(O.y),e.rXU(x.a),e.rXU(P.J))};static \u0275cmp=e.VBU({type:s,selectors:[["app-armory"]],decls:6,vars:3,consts:[[1,"content"],["class","selected",4,"ngIf"],[1,"filters"],["class","materials",4,"ngFor","ngForOf"],[1,"items-container"],["class","items-group",4,"ngFor","ngForOf"],[1,"selected"],[1,"materials"],[1,"icon"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"items-group"],[1,"title"],[1,"container"],[4,"ngFor","ngForOf"],[3,"craftItem","item","unlockedItemIds"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.DNE(1,T,2,2,"div",1),e.j41(2,"div",2),e.DNE(3,L,3,3,"div",3),e.k0s()(),e.j41(4,"div",4),e.DNE(5,G,5,2,"div",5),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngIf",o.selectedItem),e.R7$(2),e.Y8G("ngForOf",o.RESOURCE_KEYS),e.R7$(2),e.Y8G("ngForOf",o.slots))},dependencies:[f.MD,f.Sq,f.bT,u.YN,u.me,u.BC,u.vS,M.S,b],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3rem}.selected[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;margin-bottom:.5rem}.filters[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem}.filters[_ngcontent-%COMP%]   .materials[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-direction:row;align-items:center}@media (max-width: 768px){.container[_ngcontent-%COMP%]{justify-content:space-around}.filters[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{justify-content:center}}"]})}return s})()}}]);