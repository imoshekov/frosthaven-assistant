"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[324],{8324:(V,y,a)=>{a.r(y),a.d(y,{ArmoryComponent:()=>Y});var u=a(467),g=a(2200),_=a(4341),k=a(7556),f=a(3757),e=a(3664),l=a(2615),O=a(4384);const S=i=>({toggled:i});function j(i,m){if(1&i){const t=e.RV6();e.j41(0,"app-single-item",7),e.bIt("craftItem",function(n){l.eBV(t);const c=e.XpG(2);return l.Njj(c.craft(n))}),e.k0s()}if(2&i){const t=m.$implicit,o=e.XpG(2);e.Y8G("item",t)("toggled",o.areRequiredItemsToggled)("unlockedItemIds",o.unlockedItemIds)}}function E(i,m){if(1&i&&(e.j41(0,"div",5),e.DNE(1,j,1,3,"app-single-item",6),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.getRequiredItems())}}let A=(()=>{class i{itemLoaderService;item;unlockedItemIds;toggled;craftItem=new e.bkB;areRequiredItemsToggled=!1;constructor(t){this.itemLoaderService=t}getItemSrc(t){let o=t.name.toLocaleLowerCase();o=o.replaceAll(" ","-");let n=t.id.toString().padStart(3,"00");return this.isItemLocked()?"./images/fh/items/item-back-fh.png":`./images/items/fh-${n}-${o}.jpeg`}isItemLocked(){return this.unlockedItemIds?.indexOf(this.item.id)<0}getItemResources(){return this.item.resources?Object.keys(this.item.resources):void 0}craft(t){this.areRequiredItemsToggled=!this.areRequiredItemsToggled,this.craftItem.emit(t||this.item)}hasRequiredItems(){return this.item.requiredItems&&this.item.requiredItems.length>0}getRequiredItems(){return this.item.requiredItems?.length>0?this.itemLoaderService.getUnlockedItems(this.item.requiredItems):[]}static \u0275fac=function(o){return new(o||i)(e.rXU(O.y))};static \u0275cmp=e.VBU({type:i,selectors:[["app-single-item"]],hostBindings:function(o,n){1&o&&e.bIt("click",function(s){return s.stopPropagation()})},inputs:{item:"item",unlockedItemIds:"unlockedItemIds",toggled:"toggled"},outputs:{craftItem:"craftItem"},decls:6,vars:7,consts:[[1,"container"],[1,"item",3,"click"],[1,"id"],[3,"src"],["class","required-items",4,"ngIf"],[1,"required-items"],[3,"item","toggled","unlockedItemIds","craftItem",4,"ngFor","ngForOf"],[3,"craftItem","item","toggled","unlockedItemIds"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1),e.bIt("click",function(){return n.craft()}),e.j41(2,"div",2),e.EFF(3),e.k0s(),e.nrm(4,"img",3),e.k0s(),e.DNE(5,E,2,1,"div",4),e.k0s()),2&o&&(e.HbH(e.eq3(5,S,n.toggled||n.areRequiredItemsToggled)),e.R7$(3),e.JRh(n.item.id),e.R7$(),e.Y8G("src",n.getItemSrc(n.item),e.B4B),e.R7$(),e.Y8G("ngIf",n.toggled||n.areRequiredItemsToggled))},dependencies:[i,g.MD,g.Sq,g.bT,_.YN],styles:[".container[_ngcontent-%COMP%], .required-items[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:.3rem}.container.toggled[_ngcontent-%COMP%]{border:1px solid var(--font-color)}.item[_ngcontent-%COMP%]{position:relative;cursor:pointer}.item[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:10px}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:240px}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;gap:.3rem;flex-direction:column;right:0;top:0;justify-content:center}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--font-color)}.item[_ngcontent-%COMP%]   .required-items[_ngcontent-%COMP%]{position:absolute;width:3rem;height:6rem;top:25px;right:0}"]})}return i})();var M=a(4675),P=a(7473),b=a(4700);function w(i,m){if(1&i){const t=e.RV6();e.j41(0,"div",18),e.bIt("mousedown",function(n){return l.eBV(t),l.Njj(n.preventDefault())})("click",function(){const n=l.eBV(t).$implicit,c=e.XpG(2);return l.Njj(c.selectItem(n))}),e.EFF(1),e.k0s()}if(2&i){const t=m.$implicit;e.R7$(),e.SpI(" ",t," ")}}function F(i,m){if(1&i){const t=e.RV6();e.j41(0,"div",13),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.closePicker())}),e.j41(1,"div",14),e.bIt("click",function(n){return l.eBV(t),l.Njj(n.stopPropagation())}),e.j41(2,"button",15),e.bIt("click",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.closePicker())}),e.EFF(3," \u2715 "),e.k0s(),e.j41(4,"div",16),e.DNE(5,w,2,1,"div",17),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(5),e.Y8G("ngForOf",t.filteredItemTypes)}}let $=(()=>{class i{appContext;notificationService;dbService;itemAdded=new e.bkB;id;type="";pickerOpen=!1;itemTypes=["head","body","legs","onehand","twohand","small","potion"];filteredItemTypes=[];constructor(t,o,n){this.appContext=t,this.notificationService=o,this.dbService=n}addItem(){var t=this;return(0,u.A)(function*(){const o="potion"===t.type?"small":t.type,n="potion"===t.type?"potion":null;try{yield t.dbService.insertCraftableItem(t.id,o,n),t.notificationService.emitInfoMessage(`${t.type} ${t.id} added.`),t.itemAdded.emit()}catch(c){t.notificationService.emitErrorMessage("Failed to add item to armory. "+(c?.message??c))}})()}openPicker(){this.pickerOpen=!0,this.filteredItemTypes=this.itemTypes.slice(),document.documentElement.classList.add("no-scroll")}closePicker(){this.pickerOpen=!1,this.filteredItemTypes=[],document.documentElement.classList.remove("no-scroll")}onTypeInput(){const t=(this.type||"").toLowerCase().trim();this.filteredItemTypes=t?this.itemTypes.filter(o=>o.toLowerCase().includes(t)):this.itemTypes.slice()}selectItem(t){this.type=t,this.closePicker()}closeModal(){this.appContext.addItemToggled=!1}static \u0275fac=function(o){return new(o||i)(e.rXU(M.B),e.rXU(P.J),e.rXU(b.a))};static \u0275cmp=e.VBU({type:i,selectors:[["app-add-item"]],outputs:{itemAdded:"itemAdded"},decls:19,vars:3,consts:[[1,"layout"],[1,"modal"],[1,"content"],[1,"title"],[1,"form-row"],["for","type"],["id","type","type","text","autocomplete","off","inputmode","search","autocapitalize","off","autocorrect","off","placeholder","Select\u2026","onfocus","if(this.value) this.value=''",3,"ngModelChange","input","focus","ngModel"],["class","item-picker-overlay",3,"click",4,"ngIf"],["for","id"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"buttons"],["type","button",1,"cancel",3,"click"],["type","button",1,"confirm",3,"click"],[1,"item-picker-overlay",3,"click"],[1,"item-picker-sheet",3,"click"],["type","button","aria-label","Close item picker",1,"picker-close",3,"click"],[1,"item-type-list"],["class","item-type-item",3,"mousedown","click",4,"ngFor","ngForOf"],[1,"item-type-item",3,"mousedown","click"]],template:function(o,n){1&o&&(e.nrm(0,"div",0),e.j41(1,"div",1)(2,"div",2)(3,"div",3),e.EFF(4,"Add Item"),e.k0s(),e.j41(5,"div",4)(6,"label",5),e.EFF(7,"Type"),e.k0s(),e.j41(8,"input",6),e.mxI("ngModelChange",function(s){return e.DH7(n.type,s)||(n.type=s),s}),e.bIt("input",function(){return n.onTypeInput()})("focus",function(){return n.openPicker()}),e.k0s()(),e.DNE(9,F,6,1,"div",7),e.j41(10,"div",4)(11,"label",8),e.EFF(12,"ID"),e.k0s(),e.j41(13,"input",9),e.mxI("ngModelChange",function(s){return e.DH7(n.id,s)||(n.id=s),s}),e.k0s()(),e.j41(14,"div",10)(15,"button",11),e.bIt("click",function(){return n.closeModal()}),e.EFF(16,"Close"),e.k0s(),e.j41(17,"button",12),e.bIt("click",function(){return n.addItem()}),e.EFF(18,"Confirm"),e.k0s()()()()),2&o&&(e.R7$(8),e.R50("ngModel",n.type),e.R7$(),e.Y8G("ngIf",n.pickerOpen),e.R7$(4),e.R50("ngModel",n.id))},dependencies:[g.MD,g.Sq,g.bT,_.YN,_.me,_.BC,_.vS,k.S],styles:[".modal[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.modal[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:root.no-scroll, .modal[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:root.no-scroll   body[_ngcontent-%COMP%]{overflow:hidden;touch-action:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;text-align:left}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;text-align:center;width:100%;margin-bottom:1rem;justify-content:center}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100px;font-weight:600;text-align:right}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%]{flex:1;margin-bottom:0;width:100%}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:20px;height:20px;vertical-align:middle}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item-picker-sheet[_ngcontent-%COMP%]{width:100%;max-width:640px;margin:0 auto;background:var(--background);max-height:50dvh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 -8px 24px #0000004d}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item-type-list[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0;overflow-y:auto;overscroll-behavior:contain;padding:.25rem 0;border-top:none;max-height:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item-type-item[_ngcontent-%COMP%]{padding:.6rem .8rem;cursor:pointer;-webkit-tap-highlight-color:transparent;border-bottom:1px solid color-mix(in oklab,var(--secondary-color) 40%,transparent)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item-type-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item-type-item[_ngcontent-%COMP%]:hover{background:var(--secondary-color)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item-type-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .picker-close[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;height:40px;min-width:40px;border-radius:8px;border:1px solid var(--secondary-color);color:var(--base-color-spots)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:.5rem;margin-top:1rem}@media (max-width: 768px){.modal[_ngcontent-%COMP%]{top:10%;width:90%}.item-type-list[_ngcontent-%COMP%]{max-height:45dvh}.item-picker-overlay[_ngcontent-%COMP%]{place-items:center}.item-picker-sheet[_ngcontent-%COMP%]{border-radius:16px;max-height:80dvh}}"]})}return i})();function G(i,m){if(1&i&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme(" selected: ",t.selectedItem.name," - ",t.selectedItem.id," ")}}function B(i,m){if(1&i){const t=e.RV6();e.j41(0,"div",9),e.nrm(1,"div",10),e.j41(2,"input",11),e.mxI("ngModelChange",function(n){const c=l.eBV(t).$implicit,s=e.XpG();return e.DH7(s.inventory[c],n)||(s.inventory[c]=n),l.Njj(n)}),e.k0s()()}if(2&i){const t=m.$implicit,o=e.XpG();e.R7$(),e.HbH(t),e.R7$(),e.R50("ngModel",o.inventory[t])}}function N(i,m){if(1&i){const t=e.RV6();e.j41(0,"app-add-item",12),e.bIt("itemAdded",function(){l.eBV(t);const n=e.XpG();return l.Njj(n.onItemAdded())}),e.k0s()}}function L(i,m){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"app-single-item",19),e.bIt("craftItem",function(n){l.eBV(t);const c=e.XpG(3);return l.Njj(c.craftItem(n))}),e.k0s()()}if(2&i){const t=m.$implicit,o=e.XpG(3);e.R7$(),e.Y8G("item",t)("unlockedItemIds",o.unlockedItemIds)}}function U(i,m){if(1&i&&(e.j41(0,"div",17),e.DNE(1,L,2,2,"div",18),e.k0s()),2&i){const t=e.XpG().$implicit,o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.getSlotItems(t))}}function X(i,m){if(1&i){const t=e.RV6();e.j41(0,"div",13)(1,"div",14),e.bIt("click",function(){const n=l.eBV(t).$implicit,c=e.XpG();return l.Njj(c.toggleCategory(n))}),e.j41(2,"span",15),e.EFF(3),e.k0s(),e.EFF(4),e.k0s(),e.DNE(5,U,2,1,"div",16),e.k0s()}if(2&i){const t=m.$implicit,o=e.XpG();e.R7$(),e.AVh("clickable",!0),e.R7$(2),e.JRh(o.isExpanded(t)?"\u25be":"\u25b8"),e.R7$(),e.SpI(" ",t," "),e.R7$(),e.Y8G("ngIf",o.isExpanded(t))}}let Y=(()=>{class i{itemLoaderService;db;notificationService;appContext;unlockedItemIds;slots=[...Object.values(f.o),"potions"];inventory={};all;head;body;legs;onehand;twohand;small;potions;RESOURCE_KEYS;selectedItem=null;expanded={};toggleCategory(t){this.expanded[t]=!this.expanded[t]}isExpanded(t){return!!this.expanded[t]}constructor(t,o,n,c){this.itemLoaderService=t,this.db=o,this.notificationService=n,this.appContext=c}ngOnInit(){var t=this;return(0,u.A)(function*(){yield t.loadUnlockedItems()})()}getSlotItems(t){return this[t]}loadUnlockedItems(){var t=this;return(0,u.A)(function*(){const o=yield t.db.getUnlockedItems();t.unlockedItemIds=o.map(n=>n.id),t.loadItems()})()}craftItem(t){this.selectedItem=t,this.printRequirements(t)}onItemAdded(){var t=this;return(0,u.A)(function*(){yield t.loadUnlockedItems()})()}loadItems(){this.all=this.itemLoaderService.getUnlockedItems(this.unlockedItemIds),this.RESOURCE_KEYS=this.itemLoaderService.ALL_RESOURCE_KEYS;const o=c=>this.all.filter(s=>((c,s)=>c?.slot?.toLocaleLowerCase()===s.toLocaleLowerCase())(s,c));this.head=o(f.o.Head),this.body=o(f.o.Body),this.legs=o(f.o.Legs),this.onehand=o(f.o.Onehand),this.twohand=o(f.o.Twohand);const n=o(f.o.Small);this.potions=n.filter(c=>this.itemLoaderService.isPotion(c)),this.small=n.filter(c=>!this.itemLoaderService.isPotion(c));for(const c of this.slots)this.expanded[c]=!0}printRequirements(t){console.log("[armory] requirements for",t.id);const o=r=>(this.all??[]).find(d=>d.id===r),c=new Set,s=new Set,h=new Set,I={},x=r=>{if(c.has(r))return;c.add(r);const d=o(r);if(!d)return s.add(r),void h.add(r);const p={...d.resources??{}};"number"==typeof d.cost&&d.cost>0&&(p.gold=(p.gold??0)+d.cost),(r=>{if(r)for(const d of Object.keys(r)){const p=Number(r[d]??0);p>0&&(I[d]=(I[d]??0)+p)}})(p);const v=(r=>{const d=r?.requiredItems??r?.requires??r?.components??r?.dependsOn??[];return Array.isArray(d)?d.filter(p=>"number"==typeof p):[]})(d);for(const R of v)s.add(R),x(R)};x(t.id);for(const r of this.RESOURCE_KEYS)this.inventory[r]=Number(I[r]??0);const C=r=>o(r)?.name??`${r}`;console.log("--- REQUIREMENTS ---"),console.log(`Item: ${C(t.id)}`);let T=!1;console.log("Materials (incl. dependencies):");for(const r of this.RESOURCE_KEYS){const d=this.inventory[r]??0;d>0&&(T=!0,console.log(`  - ${r}: ${d}`))}if(T||console.log("  (none)"),s.size>0){console.log("Dependent items:");for(const r of s){const d=h.has(r)?"[LOCKED]":"[Unlocked]";console.log(`  - ${C(r)} (id: ${r}) ${d}`)}}else console.log("Dependent items: none");if(console.log("--------------------"),h.size>0){const r=Array.from(h).map(v=>`${C(v)}`).join(", "),p=`Cannot craft "${C(t.id)}" \u2014 ${r} locked.`;this.notificationService.emitErrorMessage(p)}else this.notificationService.emitInfoMessage("required materials loaded")}static \u0275fac=function(o){return new(o||i)(e.rXU(O.y),e.rXU(b.a),e.rXU(P.J),e.rXU(M.B))};static \u0275cmp=e.VBU({type:i,selectors:[["app-armory"]],decls:9,vars:4,consts:[[1,"content"],["class","selected",4,"ngIf"],[1,"filters"],["class","materials",4,"ngFor","ngForOf"],[1,"cancel","add",3,"click"],[3,"itemAdded",4,"ngIf"],[1,"items-container"],["class","items-group",4,"ngFor","ngForOf"],[1,"selected"],[1,"materials"],[1,"icon"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[3,"itemAdded"],[1,"items-group"],[1,"title",3,"click"],[1,"chev"],["class","container",4,"ngIf"],[1,"container"],[4,"ngFor","ngForOf"],[3,"craftItem","item","unlockedItemIds"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.DNE(1,G,2,2,"div",1),e.j41(2,"div",2),e.DNE(3,B,3,3,"div",3),e.j41(4,"button",4),e.bIt("click",function(){return n.appContext.addItemToggled=!n.appContext.addItemToggled}),e.EFF(5,"+"),e.k0s(),e.DNE(6,N,1,0,"app-add-item",5),e.k0s()(),e.j41(7,"div",6),e.DNE(8,X,6,5,"div",7),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngIf",n.selectedItem),e.R7$(2),e.Y8G("ngForOf",n.RESOURCE_KEYS),e.R7$(3),e.Y8G("ngIf",n.appContext.addItemToggled),e.R7$(2),e.Y8G("ngForOf",n.slots))},dependencies:[g.MD,g.Sq,g.bT,_.YN,_.me,_.BC,_.vS,k.S,A,$],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3rem}.selected[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;margin-bottom:.5rem}.filters[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem}.filters[_ngcontent-%COMP%]   .materials[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-direction:row;align-items:center}@media (max-width: 768px){.container[_ngcontent-%COMP%]{justify-content:space-around}.filters[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{justify-content:center}}.title.clickable[_ngcontent-%COMP%]{cursor:pointer}.title.clickable[_ngcontent-%COMP%]:hover{opacity:.9}"]})}return i})()}}]);