"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[559],{8559:(O,p,r)=>{r.r(p),r.d(p,{AlchemyComponent:()=>w});var h=r(467),l=r(2200),d=r(4341),t=r(3664);function f(i,c){1&i&&t.nrm(0,"div",6),2&i&&t.HbH(c.$implicit)}function m(i,c){if(1&i&&(t.j41(0,"div",4),t.DNE(1,f,1,2,"div",5),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.getPotionResources())}}let g=(()=>{class i{potion;unlockedPotionIds;brewPotion=new t.bkB;constructor(){}getPotionSrc(e){let n=e.name.toLocaleLowerCase();n=n.replaceAll(" ","-");let o=e.id<100?"0"+e.id:e.id;return this.isPotionLocked()?"./images/fh/items/item-back-fh.png":`./images/potions/fh-${o}-${n}.jpeg`}isPotionLocked(){return this.unlockedPotionIds?.indexOf(this.potion.id)<0}getPotionResources(){return Object.keys(this.potion.resources)}brew(){this.brewPotion.emit(this.potion.resources)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=t.VBU({type:i,selectors:[["app-single-potion"]],inputs:{potion:"potion",unlockedPotionIds:"unlockedPotionIds"},outputs:{brewPotion:"brewPotion"},decls:5,vars:3,consts:[[1,"potion",3,"click"],[1,"id"],[3,"src"],["class","resources",4,"ngIf"],[1,"resources"],["class","icon",3,"class",4,"ngFor","ngForOf"],[1,"icon"]],template:function(n,o){1&n&&(t.j41(0,"div",0),t.bIt("click",function(){return o.brew()}),t.j41(1,"div",1),t.EFF(2),t.k0s(),t.nrm(3,"img",2),t.DNE(4,m,2,1,"div",3),t.k0s()),2&n&&(t.R7$(2),t.JRh(o.potion.id),t.R7$(),t.Y8G("src",o.getPotionSrc(o.potion),t.B4B),t.R7$(),t.Y8G("ngIf",o.isPotionLocked()))},dependencies:[l.MD,l.Sq,l.bT,d.YN],styles:[".potion[_ngcontent-%COMP%]{position:relative;cursor:pointer}.potion[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:10px}.potion[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:240px}.potion[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;gap:.3rem;flex-direction:column;right:0;top:0;justify-content:center}.potion[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--font-color)}"]})}return i})();var _=r(7556),a=r(2615),b=r(4384),v=r(4700);function P(i,c){if(1&i){const e=t.RV6();t.j41(0,"div",9),t.nrm(1,"div",10),t.j41(2,"input",11),t.mxI("ngModelChange",function(o){const s=a.eBV(e).$implicit,u=t.XpG();return t.DH7(u.inventory[s],o)||(u.inventory[s]=o),a.Njj(o)}),t.k0s()()}if(2&i){const e=c.$implicit,n=t.XpG();t.R7$(),t.HbH(e),t.R7$(),t.R50("ngModel",n.inventory[e])}}function C(i,c){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"app-single-potion",14),t.bIt("brewPotion",function(o){a.eBV(e);const s=t.XpG(2);return a.Njj(s.brewPotion(o))}),t.k0s()()}if(2&i){const e=c.$implicit,n=t.XpG(2);t.R7$(),t.Y8G("potion",e)("unlockedPotionIds",n.unlockedPotionIds)}}function y(i,c){if(1&i&&(t.j41(0,"div",12),t.DNE(1,C,2,2,"div",13),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.twoHerbsPotions)}}function k(i,c){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"app-single-potion",14),t.bIt("brewPotion",function(o){a.eBV(e);const s=t.XpG(2);return a.Njj(s.brewPotion(o))}),t.k0s()()}if(2&i){const e=c.$implicit,n=t.XpG(2);t.R7$(),t.Y8G("potion",e)("unlockedPotionIds",n.unlockedPotionIds)}}function E(i,c){if(1&i&&(t.j41(0,"div",15),t.DNE(1,k,2,2,"div",13),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.threeHerbsPotions)}}let w=(()=>{class i{dataLoader;db;unlockedPotionIds;potions;twoHerbsPotions=[];threeHerbsPotions=[];wierdPotions=[];inventory={};RESOURCE_KEYS;expanded={};constructor(e,n){this.dataLoader=e,this.db=n,this.filterCraftable(),this.RESOURCE_KEYS=this.dataLoader.HERB_RESOURCE_KEYS}ngOnInit(){var e=this;return(0,h.A)(function*(){yield e.loadUnlockedPotions(),e.expanded["Two herbs"]=!0,e.expanded["Three herbs"]=!0})()}toggleCategory(e){this.expanded[e]=!this.expanded[e]}isExpanded(e){return!!this.expanded[e]}splitByHerbsCount(){this.twoHerbsPotions=[],this.threeHerbsPotions=[],this.wierdPotions=[],this.potions.forEach(e=>{const n=Object.keys(e.resources).length;2===n?this.twoHerbsPotions.push(e):3===n?this.threeHerbsPotions.push(e):this.wierdPotions.push(e)})}filterCraftable(){this.potions=this.dataLoader.getPotionsItems().filter(e=>this.canCraft(e.resources)),this.splitByHerbsCount()}clear(){this.inventory={},this.filterCraftable()}brewPotion(e){for(const n in e)this.inventory[n]=(this.inventory[n]??0)-(e[n]??0);this.filterCraftable()}loadUnlockedPotions(){var e=this;return(0,h.A)(function*(){const n=yield e.db.getUnlockedPotions();e.unlockedPotionIds=n.map(o=>o.id)})()}canCraft(e){if(this.isInventoryEmpty())return!0;for(const n in e)if((this.inventory[n]??0)<(e[n]??0))return!1;return!0}isInventoryEmpty(){for(const e in this.inventory)if(0!=(this.inventory[e]??0))return!1;return!0}static \u0275fac=function(n){return new(n||i)(t.rXU(b.y),t.rXU(v.a))};static \u0275cmp=t.VBU({type:i,selectors:[["app-alchemy"]],decls:18,vars:5,consts:[[1,"filters","content"],[1,"herbs-container"],["class","herbs",4,"ngFor","ngForOf"],[1,"cancel",3,"click"],[1,"potions-container"],[1,"title","clickable",3,"click"],[1,"chev"],["class","two-herbs container",4,"ngIf"],["class","three-herbs container",4,"ngIf"],[1,"herbs"],[1,"icon"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"two-herbs","container"],[4,"ngFor","ngForOf"],[3,"brewPotion","potion","unlockedPotionIds"],[1,"three-herbs","container"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,P,3,3,"div",2),t.k0s(),t.j41(3,"button",3),t.bIt("click",function(){return o.filterCraftable()}),t.EFF(4,"Brew"),t.k0s(),t.j41(5,"button",3),t.bIt("click",function(){return o.clear()}),t.EFF(6,"All"),t.k0s()(),t.j41(7,"div",4)(8,"div",5),t.bIt("click",function(){return o.toggleCategory("Two herbs")}),t.j41(9,"span",6),t.EFF(10),t.k0s(),t.EFF(11," Two herbs "),t.k0s(),t.DNE(12,y,2,1,"div",7),t.j41(13,"div",5),t.bIt("click",function(){return o.toggleCategory("Three herbs")}),t.j41(14,"span",6),t.EFF(15),t.k0s(),t.EFF(16," Three herbs "),t.k0s(),t.DNE(17,E,2,1,"div",8),t.k0s()),2&n&&(t.R7$(2),t.Y8G("ngForOf",o.RESOURCE_KEYS),t.R7$(8),t.JRh(o.isExpanded("Two herbs")?"\u25be":"\u25b8"),t.R7$(2),t.Y8G("ngIf",o.isExpanded("Two herbs")),t.R7$(3),t.JRh(o.isExpanded("Three herbs")?"\u25be":"\u25b8"),t.R7$(2),t.Y8G("ngIf",o.isExpanded("Three herbs")))},dependencies:[l.MD,l.Sq,l.bT,d.YN,d.me,d.BC,d.vS,g,_.S],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3rem}.filters[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem}.filters[_ngcontent-%COMP%]   .herbs-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.filters[_ngcontent-%COMP%]   .herbs[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:1rem}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{flex-direction:column}.container[_ngcontent-%COMP%]{justify-content:space-around}.herbs-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;justify-content:center}.title[_ngcontent-%COMP%]{justify-content:center}}"]})}return i})()}}]);