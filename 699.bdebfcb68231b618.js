"use strict";(self.webpackChunkfrosthaven_assistant_angular=self.webpackChunkfrosthaven_assistant_angular||[]).push([[699],{4699:(A,C,c)=>{c.r(C),c.d(C,{ArmoryComponent:()=>P});var _=c(467),g=c(2200),p=c(4341),S=c(7556),d=c(3757),t=c(3664);function k(i,m){if(1&i&&t.nrm(0,"div",6),2&i){const e=t.XpG(2);t.HbH(e.item)}}function E(i,m){if(1&i&&(t.j41(0,"div",4),t.DNE(1,k,1,2,"div",5),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.getItemResources())}}let M=(()=>{class i{item;unlockedItemIds;craftItem=new t.bkB;constructor(){}getItemSrc(e){let o=e.name.toLocaleLowerCase();o=o.replaceAll(" ","-");let s=e.id.toString().padStart(3,"00");return this.isItemLocked()?"./images/fh/items/item-back-fh.png":`./images/items/fh-${s}-${o}.jpeg`}isItemLocked(){return this.unlockedItemIds?.indexOf(this.item.id)<0}getItemResources(){return Object.keys(this.item.resources)}craft(){this.craftItem.emit(this.item)}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=t.VBU({type:i,selectors:[["app-single-item"]],inputs:{item:"item",unlockedItemIds:"unlockedItemIds"},outputs:{craftItem:"craftItem"},decls:5,vars:3,consts:[[1,"item",3,"click"],[1,"id"],[3,"src"],["class","resources",4,"ngIf"],[1,"resources"],["class","icon",3,"class",4,"ngFor","ngForOf"],[1,"icon"]],template:function(o,s){1&o&&(t.j41(0,"div",0),t.bIt("click",function(){return s.craft()}),t.j41(1,"div",1),t.EFF(2),t.k0s(),t.nrm(3,"img",2),t.DNE(4,E,2,1,"div",3),t.k0s()),2&o&&(t.R7$(2),t.JRh(s.item.id),t.R7$(),t.Y8G("src",s.getItemSrc(s.item),t.B4B),t.R7$(),t.Y8G("ngIf",s.isItemLocked()))},dependencies:[g.MD,g.Sq,g.bT,p.YN],styles:[".item[_ngcontent-%COMP%]{position:relative;cursor:pointer}.item[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:10px}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:240px}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;gap:.3rem;flex-direction:column;right:0;top:0;justify-content:center}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--font-color)}"]})}return i})();var u=c(2615),$=c(4384),j=c(1948),x=c(7473);function b(i,m){if(1&i){const e=t.RV6();t.j41(0,"div",4),t.nrm(1,"div",5),t.j41(2,"input",6),t.mxI("ngModelChange",function(s){const l=u.eBV(e).$implicit,f=t.XpG();return t.DH7(f.inventory[l],s)||(f.inventory[l]=s),u.Njj(s)}),t.k0s()()}if(2&i){const e=m.$implicit,o=t.XpG();t.R7$(),t.HbH(e),t.R7$(),t.R50("ngModel",o.inventory[e])}}function F(i,m){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"app-single-item",11),t.bIt("craftItem",function(s){u.eBV(e);const l=t.XpG(2);return u.Njj(l.craftItem(s))}),t.k0s()()}if(2&i){const e=m.$implicit,o=t.XpG(2);t.R7$(),t.Y8G("item",e)("unlockedItemIds",o.unlockedItemIds)}}function L(i,m){if(1&i&&(t.j41(0,"div",7)(1,"div",8),t.EFF(2),t.k0s(),t.j41(3,"div",9),t.DNE(4,F,2,2,"div",10),t.k0s()()),2&i){const e=m.$implicit,o=t.XpG();t.R7$(2),t.JRh(e),t.R7$(2),t.Y8G("ngForOf",o.getSlotItems(e))}}let P=(()=>{class i{dataLoader;db;notificationService;unlockedItemIds;slots=Object.values(d.o);inventory={};all;head;body;legs;onehand;twohand;small;RESOURCE_KEYS;constructor(e,o,s){this.dataLoader=e,this.db=o,this.notificationService=s}ngOnInit(){var e=this;return(0,_.A)(function*(){yield e.loadUnlockedItems()})()}getSlotItems(e){return this[e]}loadUnlockedItems(){var e=this;return(0,_.A)(function*(){const o=yield e.db.getUnlockedItems();e.unlockedItemIds=o.map(s=>s.id),e.loadItems()})()}craftItem(e){this.printRequirements(e)}loadItems(){this.all=this.dataLoader.getUnlockedItems(this.unlockedItemIds),this.RESOURCE_KEYS=this.dataLoader.ALL_RESOURCE_KEYS,Object.entries({head:d.o.Head,body:d.o.Body,legs:d.o.Legs,onehand:d.o.Onehand,twohand:d.o.Twohand,small:d.o.Small}).forEach(([o,s])=>{this[o]=this.all.filter(l=>l?.slot?.toLocaleLowerCase()===s.toLocaleLowerCase())})}printRequirements(e){console.log("[armory] requirements for",e.id);const o=n=>(this.all??[]).find(r=>r.id===n),l=new Set,f=new Set,h=new Set,y={},O=n=>{if(l.has(n))return;l.add(n);const r=o(n);if(!r)return f.add(n),void h.add(n);(n=>{if(n)for(const r of Object.keys(n)){const a=Number(n[r]??0);a>0&&(y[r]=(y[r]??0)+a)}})(r.resources);const a=(n=>{const r=n?.requiredItems??n?.requires??n?.components??n?.dependsOn??[];return Array.isArray(r)?r.filter(a=>"number"==typeof a):[]})(r);for(const I of a)f.add(I),O(I)};O(e.id);for(const n of this.RESOURCE_KEYS)this.inventory[n]=Number(y[n]??0);const v=n=>o(n)?.name??`${n}`;console.log("--- REQUIREMENTS ---"),console.log(`Item: ${v(e.id)}`);let R=!1;console.log("Materials (incl. dependencies):");for(const n of this.RESOURCE_KEYS){const r=this.inventory[n]??0;r>0&&(R=!0,console.log(`  - ${n}: ${r}`))}if(R||console.log("  (none)"),f.size>0){console.log("Dependent items:");for(const n of f){const r=h.has(n)?"[LOCKED]":"[Unlocked]";console.log(`  - ${v(n)} (id: ${n}) ${r}`)}}else console.log("Dependent items: none");if(console.log("--------------------"),h.size>0){const n=Array.from(h).map(I=>`${v(I)}`).join(", "),a=`Cannot craft "${v(e.id)}" \u2014 ${n} locked.`;this.notificationService.emitErrorMessage(a)}else this.notificationService.emitInfoMessage("required materials loaded")}static \u0275fac=function(o){return new(o||i)(t.rXU($.y),t.rXU(j.a),t.rXU(x.J))};static \u0275cmp=t.VBU({type:i,selectors:[["app-armory"]],decls:4,vars:2,consts:[[1,"filters","content"],["class","materials",4,"ngFor","ngForOf"],[1,"items-container"],["class","items-group",4,"ngFor","ngForOf"],[1,"materials"],[1,"icon"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"items-group"],[1,"title"],[1,"container"],[4,"ngFor","ngForOf"],[3,"craftItem","item","unlockedItemIds"]],template:function(o,s){1&o&&(t.j41(0,"div",0),t.DNE(1,b,3,3,"div",1),t.k0s(),t.j41(2,"div",2),t.DNE(3,L,5,2,"div",3),t.k0s()),2&o&&(t.R7$(),t.Y8G("ngForOf",s.RESOURCE_KEYS),t.R7$(2),t.Y8G("ngForOf",s.slots))},dependencies:[g.MD,g.Sq,p.YN,p.me,p.BC,p.vS,S.S,M],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3rem}.filters[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem}.filters[_ngcontent-%COMP%]   .materials[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-direction:row;align-items:center}@media (max-width: 768px){.container[_ngcontent-%COMP%]{justify-content:space-around}.filters[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{justify-content:center}}"]})}return i})()}}]);