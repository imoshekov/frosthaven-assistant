"use strict";(self.webpackChunkfrosthaven_assistant_angular=self.webpackChunkfrosthaven_assistant_angular||[]).push([[699],{4699:(A,C,c)=>{c.r(C),c.d(C,{ArmoryComponent:()=>P});var _=c(467),g=c(2200),p=c(4341),S=c(7556),m=c(3757),t=c(3664);function k(s,d){if(1&s&&t.nrm(0,"div",6),2&s){const e=t.XpG(2);t.HbH(e.item)}}function E(s,d){if(1&s&&(t.j41(0,"div",4),t.DNE(1,k,1,2,"div",5),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.getItemResources())}}let M=(()=>{class s{item;unlockedItemIds;craftItem=new t.bkB;constructor(){}getItemSrc(e){let o=e.name.toLocaleLowerCase();o=o.replaceAll(" ","-");let i=e.id.toString().padStart(3,"00");return this.isItemLocked()?"./images/fh/items/item-back-fh.png":`./images/items/fh-${i}-${o}.jpeg`}isItemLocked(){return this.unlockedItemIds?.indexOf(this.item.id)<0}getItemResources(){return Object.keys(this.item.resources)}craft(){this.craftItem.emit(this.item)}static \u0275fac=function(o){return new(o||s)};static \u0275cmp=t.VBU({type:s,selectors:[["app-single-item"]],inputs:{item:"item",unlockedItemIds:"unlockedItemIds"},outputs:{craftItem:"craftItem"},decls:5,vars:3,consts:[[1,"item",3,"click"],[1,"id"],[3,"src"],["class","resources",4,"ngIf"],[1,"resources"],["class","icon",3,"class",4,"ngFor","ngForOf"],[1,"icon"]],template:function(o,i){1&o&&(t.j41(0,"div",0),t.bIt("click",function(){return i.craft()}),t.j41(1,"div",1),t.EFF(2),t.k0s(),t.nrm(3,"img",2),t.DNE(4,E,2,1,"div",3),t.k0s()),2&o&&(t.R7$(2),t.JRh(i.item.id),t.R7$(),t.Y8G("src",i.getItemSrc(i.item),t.B4B),t.R7$(),t.Y8G("ngIf",i.isItemLocked()))},dependencies:[g.MD,g.Sq,g.bT,p.YN],styles:[".item[_ngcontent-%COMP%]{position:relative;cursor:pointer}.item[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:10px}.item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:160px;height:240px}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]{position:absolute;height:100%;display:flex;gap:.3rem;flex-direction:column;right:0;top:0;justify-content:center}.item[_ngcontent-%COMP%]   .resources[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--font-color)}"]})}return s})();var h=c(2615),$=c(4384),j=c(1948),x=c(7473);function b(s,d){if(1&s){const e=t.RV6();t.j41(0,"div",4),t.nrm(1,"div",5),t.j41(2,"input",6),t.mxI("ngModelChange",function(i){const l=h.eBV(e).$implicit,f=t.XpG();return t.DH7(f.inventory[l],i)||(f.inventory[l]=i),h.Njj(i)}),t.k0s()()}if(2&s){const e=d.$implicit,o=t.XpG();t.R7$(),t.HbH(e),t.R7$(),t.R50("ngModel",o.inventory[e])}}function F(s,d){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"app-single-item",11),t.bIt("craftItem",function(i){h.eBV(e);const l=t.XpG(2);return h.Njj(l.craftItem(i))}),t.k0s()()}if(2&s){const e=d.$implicit,o=t.XpG(2);t.R7$(),t.Y8G("item",e)("unlockedItemIds",o.unlockedItemIds)}}function L(s,d){if(1&s&&(t.j41(0,"div",7)(1,"div",8),t.EFF(2),t.k0s(),t.j41(3,"div",9),t.DNE(4,F,2,2,"div",10),t.k0s()()),2&s){const e=d.$implicit,o=t.XpG();t.R7$(2),t.JRh(e),t.R7$(2),t.Y8G("ngForOf",o.getSlotItems(e))}}let P=(()=>{class s{dataLoader;db;notificationService;unlockedItemIds;slots=Object.values(m.o);inventory={};all;head;body;legs;onehand;twohand;small;RESOURCE_KEYS;constructor(e,o,i){this.dataLoader=e,this.db=o,this.notificationService=i}ngOnInit(){var e=this;return(0,_.A)(function*(){yield e.loadUnlockedItems()})()}getSlotItems(e){return this[e]}loadUnlockedItems(){var e=this;return(0,_.A)(function*(){const o=yield e.db.getUnlockedItems();e.unlockedItemIds=o.map(i=>i.id),e.loadItems()})()}craftItem(e){this.printRequirements(e.id)}loadItems(){this.all=this.dataLoader.getUnlockedItems(this.unlockedItemIds),this.RESOURCE_KEYS=this.dataLoader.ALL_RESOURCE_KEYS,Object.entries({head:m.o.Head,body:m.o.Body,legs:m.o.Legs,onehand:m.o.Onehand,twohand:m.o.Twohand,small:m.o.Small}).forEach(([o,i])=>{this[o]=this.all.filter(l=>l?.slot?.toLocaleLowerCase()===i.toLocaleLowerCase())})}printRequirements(e){console.log("[armory] requirements for",e);const o=n=>(this.all??[]).find(r=>r.id===n),l=new Set,f=new Set,v=new Set,y={},O=n=>{if(l.has(n))return;l.add(n);const r=o(n);if(!r)return f.add(n),void v.add(n);(n=>{if(n)for(const r of Object.keys(n)){const a=Number(n[r]??0);a>0&&(y[r]=(y[r]??0)+a)}})(r.resources);const a=(n=>{const r=n?.requiredItems??n?.requires??n?.components??n?.dependsOn??[];return Array.isArray(r)?r.filter(a=>"number"==typeof a):[]})(r);for(const u of a)f.add(u),O(u)};O(e);for(const n of this.RESOURCE_KEYS)this.inventory[n]=Number(y[n]??0);const I=n=>o(n)?.name??`${n}`;console.log("--- REQUIREMENTS ---"),console.log(`Item: ${I(e)}`);let R=!1;console.log("Materials (incl. dependencies):");for(const n of this.RESOURCE_KEYS){const r=this.inventory[n]??0;r>0&&(R=!0,console.log(`  - ${n}: ${r}`))}if(R||console.log("  (none)"),f.size>0){console.log("Dependent items:");for(const n of f){const r=v.has(n)?"[LOCKED]":"[Unlocked]";console.log(`  - ${I(n)} (id: ${n}) ${r}`)}}else console.log("Dependent items: none");if(console.log("--------------------"),v.size>0){const n=Array.from(v).map(u=>`${I(u)} (id: ${u})`).join(", "),a=`Cannot craft "${I(e)}" \u2014 locked dependency: ${n}.`;this.notificationService.emitErrorMessage(a)}}static \u0275fac=function(o){return new(o||s)(t.rXU($.y),t.rXU(j.a),t.rXU(x.J))};static \u0275cmp=t.VBU({type:s,selectors:[["app-armory"]],decls:4,vars:2,consts:[[1,"filters","content"],["class","materials",4,"ngFor","ngForOf"],[1,"items-container"],["class","items-group",4,"ngFor","ngForOf"],[1,"materials"],[1,"icon"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"items-group"],[1,"title"],[1,"container"],[4,"ngFor","ngForOf"],[3,"craftItem","item","unlockedItemIds"]],template:function(o,i){1&o&&(t.j41(0,"div",0),t.DNE(1,b,3,3,"div",1),t.k0s(),t.j41(2,"div",2),t.DNE(3,L,5,2,"div",3),t.k0s()),2&o&&(t.R7$(),t.Y8G("ngForOf",i.RESOURCE_KEYS),t.R7$(2),t.Y8G("ngForOf",i.slots))},dependencies:[g.MD,g.Sq,p.YN,p.me,p.BC,p.vS,S.S,M],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.3rem}.filters[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem}.filters[_ngcontent-%COMP%]   .materials[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-direction:row;align-items:center}@media (max-width: 768px){.container[_ngcontent-%COMP%]{justify-content:space-around}.filters[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{justify-content:center}}"]})}return s})()}}]);