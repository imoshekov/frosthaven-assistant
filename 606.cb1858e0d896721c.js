"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[606],{2606:(K,w,m)=>{m.r(w),m.d(w,{ScenarioComponent:()=>Qt});var p=m(2200),x=m(1413),b=m(6977),_=m(4341),u=m(8880),v=m(7556),e=m(3664),s=m(2615),C=m(4675),E=m(4700),I=m(130),P=m(7473);let D=(()=>{class i{levelFromXp(t){const o=Math.min(u.Wl,Math.max(0,t));let n=1;for(let r=1;r<u.ej.length;r++)o>=u.ej[r]&&(n=r+1);return Math.min(u.sD,n)}progressToNextLevelPercent(t){const o=Math.max(0,Math.min(u.Wl,t)),n=this.levelFromXp(o);if(n>=u.sD)return 100;const r=u.ej[n-1];return Math.max(0,Math.min(100,(o-r)/(u.ej[n]-r)*100))}xpToNextLevel(t){const o=Math.max(0,Math.min(u.Wl,t)),n=this.levelFromXp(o);return n>=u.sD?0:Math.max(0,u.ej[n]-o)}static \u0275fac=function(o){return new(o||i)};static \u0275prov=s.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();const Z=(i,c,t)=>[i,c,t];function q(i,c){if(1&i&&(e.j41(0,"div",9),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI(" ",t.creature.type," ")}}function ee(i,c){if(1&i&&(e.j41(0,"div",9)(1,"div",10)(2,"span",11),e.EFF(3),e.k0s()()()),2&i){const t=e.XpG();e.R7$(3),e.JRh(t.creature.level)}}function te(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=c.$implicit;e.R7$(),e.SpI(" ",t," ")}}function ne(i,c){if(1&i&&(e.j41(0,"div",12)(1,"div",13)(2,"div",14),e.DNE(3,te,2,1,"span",15),e.k0s(),e.j41(4,"div",16),e.nrm(5,"span",17),e.j41(6,"span",18),e.EFF(7),e.k0s()()()()),2&i){const t=e.XpG();e.R7$(3),e.Y8G("ngForOf",(t.creature.totalXp+"").split("")),e.R7$(2),e.xc7("height",t.getXpPercentToNext(t.creature.totalXp),"%"),e.R7$(2),e.SpI(" ",t.getXpRemainingToNext(t.creature.totalXp)," ")}}function oe(i,c){1&i&&e.nrm(0,"div",29)}function ie(i,c){if(1&i&&(e.j41(0,"span",23),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.JRh(t.creature.attackTarget)}}function re(i,c){if(1&i&&(e.j41(0,"div",21)(1,"div",30),e.EFF(2),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(2),e.JRh(t.creature.armor+t.creature.roundArmor)}}function ae(i,c){if(1&i&&(e.j41(0,"div",33),e.EFF(1),e.k0s()),2&i){const t=e.XpG(3);e.R7$(),e.JRh(t.creature.retaliateRange)}}function ce(i,c){if(1&i&&(e.j41(0,"div",21)(1,"div",31),e.EFF(2),e.k0s(),e.DNE(3,ae,2,1,"div",32),e.k0s()),2&i){const t=e.XpG(2);e.R7$(2),e.JRh(t.creature.retaliate+t.creature.roundRetaliate),e.R7$(),e.Y8G("ngIf",t.creature.retaliateRange>0)}}function se(i,c){1&i&&e.nrm(0,"div",36),2&i&&e.HbH(c.$implicit.value)}function le(i,c){if(1&i&&(e.j41(0,"div",34),e.DNE(1,se,1,2,"div",35),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.creature.actions)}}function de(i,c){1&i&&(e.j41(0,"div",21),e.nrm(1,"div",37),e.k0s())}function pe(i,c){if(1&i&&(e.j41(0,"div",19)(1,"div",20)(2,"div",21),e.nrm(3,"div",22),e.j41(4,"span",23),e.EFF(5),e.k0s(),e.DNE(6,oe,1,0,"div",24)(7,ie,2,1,"span",25),e.k0s(),e.DNE(8,re,3,1,"div",26)(9,ce,4,2,"div",26)(10,le,2,1,"div",27),e.k0s(),e.j41(11,"div",20)(12,"div",21),e.nrm(13,"div",28),e.j41(14,"span",23),e.EFF(15),e.k0s()(),e.DNE(16,de,2,0,"div",26),e.k0s()()),2&i){const t=e.XpG();e.R7$(2),e.AVh("bordered",t.hasExtraStats(t.creature)),e.R7$(3),e.JRh(t.creature.attack),e.R7$(),e.Y8G("ngIf",t.creature.attackTarget>1),e.R7$(),e.Y8G("ngIf",t.creature.attackTarget>1),e.R7$(),e.Y8G("ngIf",t.creature.armor+t.creature.roundArmor>0),e.R7$(),e.Y8G("ngIf",t.creature.retaliate+t.creature.roundRetaliate>0),e.R7$(),e.Y8G("ngIf",t.creature.aggressive&&(null==t.creature.actions?null:t.creature.actions.length)),e.R7$(2),e.AVh("bordered",t.creature.flying),e.R7$(3),e.JRh(t.creature.movement),e.R7$(),e.Y8G("ngIf",t.creature.flying)}}function ue(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",19)(1,"div",20)(2,"div",21)(3,"div",38)(4,"input",3),e.bIt("blur",function(n){s.eBV(t);const r=e.XpG();return s.Njj(r.updateCreatureHp(r.creature.id,+n.target.value))}),e.k0s()()()(),e.j41(5,"div",20)(6,"div",21)(7,"div",39)(8,"input",40),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.onSessionXpClick(n.creature))})("blur",function(n){s.eBV(t);const r=e.XpG();return s.Njj(r.onSessionXpBlur(r.creature,n))}),e.k0s()()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.Y8G("value",t.creature.hp),e.R7$(4),e.Y8G("value",t.creature.sessionExperience??0)}}let ge=(()=>{class i{appContext;dbService;dataLoader;notificationService;xpService;creature;constructor(t,o,n,r,a){this.appContext=t,this.dbService=o,this.dataLoader=n,this.notificationService=r,this.xpService=a}getCreaturePic(t){return t.aggressive?`./images/monster/thumbnail/fh-${t?.type}.png`:`./images/character/thumbnail/fh-${t?.type}.png`}onImgError(t){t.target.src="./images/bb/daemon-skull.svg"}openConditionModal(){this.appContext.selectedCreature=this.creature,this.appContext.isGroupSelected=!0}hasExtraStats(t){return t.armor+t.roundArmor>0||t.retaliate+t.roundRetaliate>0||t.aggressive&&t.actions?.length>0||t.flying}updateCreatureHp(t,o){const n=this.appContext.findCreature(t),r=Math.min(o,n.maxHp);this.appContext.updateCreatureBaseStat(t,"hp",r),r<=0&&this.appContext.killCreature(t)}getXpPercentToNext(t){return this.xpService.progressToNextLevelPercent(t??0)}getXpRemainingToNext(t){return this.xpService.xpToNextLevel(t??0)}onSessionXpClick(t){if(!t.id)return;const o=this.appContext.findCreature(t.id).sessionExperience??0;this.setSessionXp(t.id,o+1)}onSessionXpBlur(t,o){if(!t.id)return;const n=o.target,r=Number(n?.value);Number.isFinite(r)&&this.setSessionXp(t.id,r)}setSessionXp(t,o){const r=this.appContext.findCreature(t).sessionExperience??0,a=Math.max(0,o),l=a-r;0!==l&&(this.appContext.updateCreatureBaseStat(t,"sessionExperience",a,!0),this.applyXpChange(t,l))}applyXpChange(t,o){const n=this.appContext.findCreature(t),a=Math.max(0,Math.min(u.Wl,(n.totalXp??0)+o)),l=this.xpService.levelFromXp(a);this.appContext.updateCreatureBaseStat(t,"totalXp",a,!0),this.appContext.updateCreatureBaseStat(t,"level",l,!0)}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B),e.rXU(E.a),e.rXU(I.X),e.rXU(P.J),e.rXU(D))};static \u0275cmp=e.VBU({type:i,selectors:[["app-creature-group-header"]],inputs:{creature:"creature"},decls:11,vars:12,consts:[[1,"creature-details",3,"ngClass"],[1,"base-stat","row"],[1,"creature-initiative"],["type","tel","maxlength","2",1,"stat-input",3,"blur","value"],["class","name",4,"ngIf"],[1,"info","row"],["class","portrait-xp",4,"ngIf"],[1,"profile",3,"error","click","src"],["class","group-stats",4,"ngIf"],[1,"name"],[1,"icon","level"],[1,"level-number"],[1,"portrait-xp"],[1,"xp-container"],[1,"xp-numbers"],[4,"ngFor","ngForOf"],[1,"xp-bar"],[1,"xp-fill"],[1,"xp-remaining"],[1,"group-stats"],[1,"stats"],[1,"base-stat"],[1,"icon","attack"],[1,"stat-value"],["class","icon target",4,"ngIf"],["class","stat-value",4,"ngIf"],["class","base-stat",4,"ngIf"],["class","traits",4,"ngIf"],[1,"icon","move"],[1,"icon","target"],[1,"icon","shield"],[1,"icon","retaliate"],["class","icon range",4,"ngIf"],[1,"icon","range"],[1,"traits"],["class","icon",3,"class",4,"ngFor","ngForOf"],[1,"icon"],[1,"icon","flying"],[1,"icon","heart"],[1,"icon","xp"],["type","tel","maxlength","2",1,"stat-input",3,"click","blur","value"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),e.bIt("blur",function(a){return n.appContext.updateCreatureBaseStat(n.creature.id,"initiative",+a.target.value,!0)}),e.k0s()(),e.DNE(4,q,2,1,"div",4)(5,ee,4,1,"div",4),e.k0s(),e.j41(6,"div",5),e.DNE(7,ne,8,4,"div",6),e.j41(8,"img",7),e.bIt("error",function(a){return n.onImgError(a)})("click",function(){return n.openConditionModal()}),e.k0s(),e.DNE(9,pe,17,12,"div",8)(10,ue,9,2,"div",8),e.k0s()()),2&o&&(e.Y8G("ngClass",e.sMw(8,Z,n.creature.type,n.creature.boss?"boss":n.creature.isElite?"elite":"non-elite",n.creature.aggressive?"":"character")),e.R7$(3),e.Y8G("value",n.creature.initiative),e.R7$(),e.Y8G("ngIf",n.creature.aggressive),e.R7$(),e.Y8G("ngIf",!n.creature.aggressive),e.R7$(2),e.Y8G("ngIf",!n.creature.aggressive),e.R7$(),e.Y8G("src",n.getCreaturePic(n.creature),e.B4B),e.R7$(),e.Y8G("ngIf",n.creature.aggressive),e.R7$(),e.Y8G("ngIf",!n.creature.aggressive))},dependencies:[p.MD,p.YU,p.Sq,p.bT,v.S,_.YN],styles:[".creature-details[_ngcontent-%COMP%]{flex-direction:column;justify-content:space-between;align-items:center;padding:0 10px 10px;display:flex;width:calc(100% - 20px);min-height:135px}.creature-details.elite[_ngcontent-%COMP%]{background:var(--elite-color)}.creature-details.non-elite[_ngcontent-%COMP%]{background:var(--nonelite-color)}.creature-details.boss[_ngcontent-%COMP%]{background:var(--boss-color)}.creature-details.character.coral[_ngcontent-%COMP%]{background-color:var(--coral-color)}.creature-details.character.fist[_ngcontent-%COMP%]{background-color:var(--fist-color)}.creature-details.character.blinkblade[_ngcontent-%COMP%]{background-color:var(--blinkblade-color)}.creature-details.character.banner-spear[_ngcontent-%COMP%]{background-color:var(--banner-spear-color)}.creature-details.character.meteor[_ngcontent-%COMP%]{background-color:var(--meteor-color)}.creature-details.character.drifter[_ngcontent-%COMP%]{background-color:var(--drifter-color)}.creature-details.character.trap[_ngcontent-%COMP%]{background-color:var(--trap-color)}.creature-details.character[_ngcontent-%COMP%]{background-color:var(--character-bg, var(--background-secondary))}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;justify-content:center;align-items:center}.name[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:.5rem}.name[_ngcontent-%COMP%]   .icon.level[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:50px;height:50px;padding-top:0}.name[_ngcontent-%COMP%]   .icon.level[_ngcontent-%COMP%]   .level-number[_ngcontent-%COMP%]{display:inline-block;font-size:15px;transform:translateY(5px)}.right-info[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:10px}.base-stat[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center}.base-stat[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:none;color:var(--font-color);border:none}img.profile[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;box-shadow:0 0 5px 2px;-webkit-user-select:none;user-select:none}.portrait-xp[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:12px}.xp-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.xp-numbers[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:15px;line-height:1.1}.xp-total[_ngcontent-%COMP%]{opacity:.85}.xp-bar[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;width:20px;height:70px;border-radius:6px;overflow:hidden;margin-right:10px;background:#3c2d1e59;box-shadow:inset 0 0 2px #00000059}.xp-fill[_ngcontent-%COMP%]{width:100%;height:0%;border-radius:6px;margin-top:auto;background:#5f7d4be6;transition:height .12s linear}.xp-remaining[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--font-color);font-size:16px;font-weight:700;line-height:10px;text-shadow:0 1px 2px rgba(0,0,0,.6);pointer-events:none}.base-info[_ngcontent-%COMP%], .group-stats[_ngcontent-%COMP%]{display:flex}.base-info[_ngcontent-%COMP%]   .traits[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .group-stats[_ngcontent-%COMP%]   .traits[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:30px;height:40px}.bordered[_ngcontent-%COMP%]{border-right:1px solid var(--secondary-color);padding-right:10px}.group-stats[_ngcontent-%COMP%]{flex-direction:column;flex-shrink:2;margin-left:10px}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{justify-content:flex-start;display:flex;margin-top:5px;gap:.5rem;flex-wrap:nowrap}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:.5rem}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:30px;height:30px;display:flex;justify-content:center;align-items:center}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon.shield[_ngcontent-%COMP%], .group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon.retaliate[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon.range[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding-right:20px}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon.heart[_ngcontent-%COMP%], .group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon.xp[_ngcontent-%COMP%]{width:35px;height:35px}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .icon.level[_ngcontent-%COMP%]{width:45px;height:45px;justify-content:center;align-items:center}.group-stats[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .base-stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{min-width:12px}.group-stats[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px}"]})}return i})();const me=(i,c)=>[i,c];function _e(i,c){if(1&i&&(e.j41(0,"div",7),e.EFF(1),e.nrm(2,"div",10),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.creature.retaliateRange," ")}}function fe(i,c){if(1&i&&(e.j41(0,"div",4)(1,"div",5),e.EFF(2),e.nrm(3,"div",6),e.k0s(),e.j41(4,"div",7),e.EFF(5),e.nrm(6,"div",8),e.k0s(),e.DNE(7,_e,3,1,"div",9),e.k0s()),2&i){const t=e.XpG();e.R7$(2),e.SpI(" ",t.creature.armor+t.creature.roundArmor," "),e.R7$(3),e.SpI(" ",t.creature.retaliate+t.creature.roundRetaliate," "),e.R7$(2),e.Y8G("ngIf",t.creature.retaliateRange>0)}}function Ce(i,c){1&i&&e.nrm(0,"div",14)}function he(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",11),e.bIt("click",function(){const n=s.eBV(t).$implicit,r=e.XpG();return s.Njj(r.toggleCondition(n))}),e.nrm(1,"div",12),e.DNE(2,Ce,1,0,"div",13),e.k0s()}if(2&i){const t=c.$implicit,o=e.XpG();e.AVh("is-immune",o.isImmune(t)),e.R7$(),e.Y8G("ngClass",e.l_i(4,me,t,o.isActive(t)?"active":"")),e.R7$(),e.Y8G("ngIf",o.isImmune(t))}}let N=(()=>{class i{creature;conditions;immunities;shouldShowBuffs;activeConditions=[];activeImmunities=[];conditionToggled=new e.bkB;constructor(){}ngOnInit(){this.creature?.conditions?.forEach(t=>{this.activeConditions.push(t)}),this.creature?.immunities?.forEach(t=>{this.activeImmunities.push(t)})}toggleCondition(t){this.isImmune(t)||(this.activeConditions.includes(t)?this.removeCondition(t):this.activeConditions.push(t),this.conditionToggled.emit(t))}isActive(t){return this.activeConditions.includes(t)}isImmune(t){return this.activeImmunities.includes(t)}removeCondition(t){const o=this.activeConditions.findIndex(n=>n===t);-1!==o&&this.activeConditions.splice(o,1)}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-conditions"]],inputs:{creature:"creature",conditions:"conditions",immunities:"immunities",shouldShowBuffs:"shouldShowBuffs"},outputs:{conditionToggled:"conditionToggled"},decls:4,vars:2,consts:[[1,"container"],["class","buffs",4,"ngIf"],[1,"conditions"],["class","condition-element",3,"is-immune","click",4,"ngFor","ngForOf"],[1,"buffs"],[1,"armor","stat"],[1,"icon","shield"],[1,"retaliate","stat"],[1,"icon","retaliate"],["class","retaliate stat",4,"ngIf"],[1,"icon","range"],[1,"condition-element",3,"click"],[1,"icon",3,"ngClass"],["class","icon immune",4,"ngIf"],[1,"icon","immune"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.DNE(1,fe,8,3,"div",1),e.j41(2,"div",2),e.DNE(3,he,3,7,"div",3),e.k0s()()),2&o&&(e.R7$(),e.Y8G("ngIf",n.shouldShowBuffs),e.R7$(2),e.Y8G("ngForOf",n.conditions))},dependencies:[p.MD,p.YU,p.Sq,p.bT],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center;height:100%;margin-bottom:.5em}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding-left:10px}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .icon.range[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .icon.range[_ngcontent-%COMP%]{width:40px;margin-left:5px}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]{position:relative;cursor:pointer;margin:5px;width:35px;height:35px}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:100%;height:100%}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:not(.active):not(.immune), .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:not(.active):not(.immune){opacity:.5;filter:brightness(50%)}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .condition-element.is-immune[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:not(.immune), .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .condition-element.is-immune[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:not(.immune){opacity:.5;filter:brightness(50%)}.container[_ngcontent-%COMP%]   .conditions[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]   .icon.immune[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .buffs[_ngcontent-%COMP%]   .condition-element[_ngcontent-%COMP%]   .icon.immune[_ngcontent-%COMP%]{position:absolute;bottom:-2px;right:-2px;width:16px;height:16px;opacity:1;filter:none;pointer-events:none}"]})}return i})();const be=(i,c)=>[i,c];function ve(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",4)(1,"input",5),e.bIt("blur",function(n){s.eBV(t);const r=e.XpG();return s.Njj(r.updateStandee(r.creature.id,r.creature.type,+n.target.value))}),e.k0s(),e.j41(2,"div",6)(3,"div",7)(4,"input",8),e.bIt("blur",function(n){s.eBV(t);const r=e.XpG();return s.Njj(r.updateCreatureHp(r.creature.id,+n.target.value))}),e.k0s()(),e.j41(5,"app-conditions",9),e.bIt("conditionToggled",function(n){s.eBV(t);const r=e.XpG();return s.Njj(r.toggleCondition(n))}),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(),e.Y8G("value",t.creature.standee),e.R7$(3),e.Y8G("value",t.creature.hp),e.R7$(),e.Y8G("creature",t.creature)("conditions",t.creature.conditions)}}function Me(i,c){if(1&i&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&i){const t=c.$implicit,o=e.XpG(2);e.xc7("background","var(--"+o.creature.type+"-color)"),e.R7$(),e.SpI(" ",t," ")}}function xe(i,c){if(1&i&&(e.j41(0,"div",10)(1,"div",11),e.EFF(2),e.k0s(),e.DNE(3,Me,2,3,"div",12),e.k0s()),2&i){const t=e.XpG();e.R7$(2),e.SpI(" ",t.creature.name," "),e.R7$(),e.Y8G("ngForOf",t.creature.traits)}}function Oe(i,c){if(1&i){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.openConditionModal())}),e.nrm(1,"div",14),e.EFF(2,"Attack "),e.k0s()}}let Pe=(()=>{class i{appContext;notificationService;creature;constructor(t,o){this.appContext=t,this.notificationService=o}openConditionModal(){this.appContext.selectedCreature=this.creature,this.appContext.isGroupSelected=!1}toggleCondition(t){this.creature&&this.appContext.toggleCreatureConditions(this.creature.id,t)}updateCreatureHp(t,o){const n=this.appContext.findCreature(t),r=Math.min(o,n.maxHp);this.appContext.updateCreatureBaseStat(t,"hp",r),r<=0&&this.appContext.killCreature(t)}updateStandee(t,o,n){this.appContext.updateCreatureBaseStat(t,"standee",n),this.appContext.updateCreatureBaseStat(t,"name",`${o} - ${n}`)}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B),e.rXU(P.J))};static \u0275cmp=e.VBU({type:i,selectors:[["app-creature"]],inputs:{creature:"creature"},decls:6,vars:9,consts:[["traitsBlock",""],[1,"container",3,"ngClass"],["class","creature-standee stat",4,"ngIf","ngIfElse"],["class","open-modal button attack",3,"click",4,"ngIf"],[1,"creature-standee","stat"],["type","tel","maxlength","2",1,"stat-input","initiative",3,"blur","value"],[1,"header","stat"],[1,"icon","heart"],["type","tel","maxlength","3",1,"stat-input",3,"blur","value"],[3,"conditionToggled","creature","conditions"],[1,"creature-traits"],[1,"trait"],["class","trait",3,"background",4,"ngFor","ngForOf"],[1,"open-modal","button","attack",3,"click"],[1,"icon","attack"]],template:function(o,n){if(1&o&&(e.j41(0,"div")(1,"div",1),e.DNE(2,ve,6,4,"div",2)(3,xe,4,2,"ng-template",null,0,e.C5r),e.k0s(),e.DNE(5,Oe,3,0,"button",3),e.k0s()),2&o){const r=e.sdS(4);e.R7$(),e.HbH(n.creature.type),e.Y8G("ngClass",e.l_i(6,be,n.creature.boss?"boss":n.creature.isElite?"elite":"non-elite",n.creature.aggressive?"":"friendly")),e.R7$(),e.Y8G("ngIf",n.creature.aggressive)("ngIfElse",r),e.R7$(3),e.Y8G("ngIf",n.creature.aggressive)}},dependencies:[p.MD,p.YU,p.Sq,p.bT,v.S,_.YN,N],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;background:var(--nonelite-color);flex-direction:column;width:100%}.container.elite[_ngcontent-%COMP%]{background:var(--elite-color)}.container.friendly[_ngcontent-%COMP%]{background-color:var(--background-color)}.container.boss[_ngcontent-%COMP%]{background-color:var(--boss-color)}.container[_ngcontent-%COMP%]   .initiative[_ngcontent-%COMP%]{border:none;background-color:var(--base-color-spots);border-radius:0 30px 30px 0;line-height:20px;font-size:20px;height:25px}.creature-traits[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;font-size:1rem;width:100%}.creature-traits[_ngcontent-%COMP%]   .trait[_ngcontent-%COMP%]{text-align:center;-webkit-user-select:none;user-select:none}input[_ngcontent-%COMP%]{background:none;color:var(--font-color)}.creature-standee[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:60px}.header[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-around;align-items:center}.header[_ngcontent-%COMP%]   .icon.heart[_ngcontent-%COMP%]{width:60px;height:60px;justify-content:center}.header[_ngcontent-%COMP%]   .icon.heart[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#fff;width:100%;height:100%;font-size:20px;box-sizing:border-box;border:none}button.open-modal[_ngcontent-%COMP%]{display:flex;width:100%;border-radius:0;border:0;border-top:1px solid;border-bottom:3px solid;justify-content:center;font-size:20px;background-color:var(--attack-button-color)}button.open-modal[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:10px;width:24px;height:24px}@media (max-width: 768px){.container[_ngcontent-%COMP%], .creature-standee[_ngcontent-%COMP%]{justify-content:center;align-items:center}.container[_ngcontent-%COMP%]   .initiative[_ngcontent-%COMP%]{border-radius:30px}}"]})}return i})();function ke(i,c){if(1&i&&(e.j41(0,"div",7),e.nrm(1,"app-creature",4),e.k0s()),2&i){const t=c.$implicit;e.Y8G("ngClass",t.type),e.R7$(),e.Y8G("creature",t)}}function ye(i,c){if(1&i&&(e.j41(0,"div",2)(1,"div",3),e.nrm(2,"app-creature-group-header",4),e.j41(3,"div",5),e.DNE(4,ke,2,2,"div",6),e.k0s()()()),2&i){const t=c.$implicit;e.Y8G("ngClass",t.creatureType.aggressive?"":"friendly"),e.R7$(2),e.Y8G("creature",t.creatureType),e.R7$(2),e.Y8G("ngForOf",t.creatures)}}let je=(()=>{class i{appContext;groupedCreatures=[];groupedGraveyard=[];unsubscribe$=new x.B;creatureHpInputs={};constructor(t){this.appContext=t,this.sortCreatures(),this.sortGraveyard(),this.appContext.creatures$.pipe((0,b.Q)(this.unsubscribe$)).subscribe(o=>{this.sortCreatures()}),this.appContext.graveyard$.pipe((0,b.Q)(this.unsubscribe$)).subscribe(o=>{this.sortGraveyard()})}sortCreatures(){const t={};for(const o of this.appContext.getCreatures()){const n=`${o.type}-${o.isElite}`;t[n]||(t[n]=[]),t[n].push(o)}this.groupedCreatures=Object.keys(t).map(o=>({type:o,creatureType:t[o][0],creatures:[...t[o]].sort((n,r)=>{const a=Number(n.standee),l=Number(r.standee);return(Number.isNaN(a)?Number.POSITIVE_INFINITY:a)-(Number.isNaN(l)?Number.POSITIVE_INFINITY:l)})}))}get sortedCreatureGroups(){return[...this.groupedCreatures].sort((t,o)=>{const n=t.creatureType,r=o.creatureType;if((n.initiative??0)!==(r.initiative??0))return(n.initiative??0)-(r.initiative??0);if(n.aggressive!==r.aggressive)return n.aggressive?1:-1;const a=(n.type||"").toLowerCase(),l=(r.type||"").toLowerCase();if(a<l)return-1;if(a>l)return 1;if(n.isElite!==r.isElite)return n.isElite?-1:1;const d=n.standee??0,g=r.standee??0;return d<g?-1:d>g?1:0})}sortGraveyard(){const t={};for(const o of this.appContext.getCreatures()){const n=`${o.type}-${o.isElite}`;t[n]||(t[n]=[]),t[n].push(o)}this.groupedGraveyard=Object.keys(t).map(o=>({type:o,creatureType:t[o][0],creatures:t[o]}))}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B))};static \u0275cmp=e.VBU({type:i,selectors:[["app-game"]],decls:2,vars:1,consts:[[1,"game-container"],["class","creature-group",3,"ngClass",4,"ngFor","ngForOf"],[1,"creature-group",3,"ngClass"],[1,"creature-container"],[3,"creature"],[1,"creature-list"],["class","creature",3,"ngClass",4,"ngFor","ngForOf"],[1,"creature",3,"ngClass"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.DNE(1,ye,5,3,"div",1),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",n.sortedCreatureGroups))},dependencies:[p.MD,p.YU,p.Sq,_.YN,ge,Pe],styles:[".game-container[_ngcontent-%COMP%]{margin-top:.5rem;display:flex;flex-direction:row;gap:.3rem;flex-wrap:wrap}.game-container[_ngcontent-%COMP%]   .creature-group[_ngcontent-%COMP%]{border:1px solid;border-color:var(--font-color);flex-grow:1}.game-container[_ngcontent-%COMP%]   .creature-group.friendly[_ngcontent-%COMP%]{flex-basis:0%}.game-container[_ngcontent-%COMP%]   .creature-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;gap:.5rem;justify-content:flex-start}.game-container[_ngcontent-%COMP%]   .creature-container[_ngcontent-%COMP%]   .creature-list[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:.5rem;flex-wrap:nowrap;width:100%}.game-container[_ngcontent-%COMP%]   .creature-container[_ngcontent-%COMP%]   .creature-list[_ngcontent-%COMP%]   .creature[_ngcontent-%COMP%]{width:100%;border:1px solid;border-color:var(--font-color)}@media (max-width: 768px){.game-container[_ngcontent-%COMP%]   .creature-container[_ngcontent-%COMP%]{max-width:none;width:100%}.game-container[_ngcontent-%COMP%]   .creature-list[_ngcontent-%COMP%]{flex-direction:column!important}}"]})}return i})();const we=(i,c)=>[i,c];function Ie(i,c){if(1&i&&(s.qSk(),e.nrm(0,"path",11)),2&i){const t=c.$implicit,o=e.XpG();e.Y8G("ngClass",e.l_i(2,we,o.element.type,o.element.state)),e.BMQ("d",t)}}let Re=(()=>{class i{appContext;element;constructor(t){this.appContext=t}symbols={fire:{transform:"matrix(0.35277777,0,0,-0.35277777,129.1384,74.102455)",d:["m 0,0 c -42.5,34.5 -58.5,99.5 -47,143.5 -25.5,-2.5 -66.272,-25.288 -83.5,-89.5 -22,-82 43.996,-140.5 0,-170.5 -51.444,-35.079 -86.5,26 -82,82.5 -30,-23.5 -48.447,-119.579 -9.5,-178 28,-42 63.811,-66.136 109.516,-71.391 -14.745,10.442 -15.741,29.913 -10.516,44.891 7.5,21.5 32.239,31.107 55.5,49 26,20 37,40 38.5,49.5 13,-19.5 28.581,-48.317 15.5,-91 -6.013,-19.62 -16.979,-38.34 -34.339,-49.45 C 7.137,-266.249 71.825,-218.559 72,-134.5 72.156,-59.5 34.135,-27.709 0,0"]},ice:{transform:"matrix(0.35277777,0,0,-0.35277777,98.77778,114.17392)",d:["M 0,0 -37.729,21.782 V 65.349 L 0,87.132 37.729,65.349 V 21.782 Z m 182.664,-2.602 -38.139,-27.986 -30.576,18.524 49.5,34.673 c 3.166,2.218 3.935,6.583 1.717,9.75 -2.219,3.165 -6.582,3.936 -9.75,1.717 L 100.863,-4.137 51.729,25.63 v 35.871 l 49.135,29.768 54.552,-38.214 c 1.223,-0.856 2.623,-1.267 4.011,-1.267 2.206,0 4.377,1.04 5.739,2.984 2.218,3.166 1.449,7.532 -1.717,9.749 l -49.499,34.675 30.575,18.524 38.139,-27.987 c 1.248,-0.916 2.698,-1.357 4.136,-1.357 2.153,0 4.278,0.99 5.649,2.859 2.287,3.118 1.614,7.498 -1.502,9.786 l -33.459,24.552 29.336,17.773 c 3.348,1.932 4.495,6.214 2.563,9.562 -1.933,3.348 -6.213,4.496 -9.563,2.562 l -30.065,-16.465 -4.529,41.199 c -0.421,3.844 -3.881,6.621 -7.722,6.193 -3.843,-0.422 -6.616,-3.879 -6.194,-7.722 l 5.161,-46.945 -31.334,-17.159 -5.268,60.069 c -0.338,3.85 -3.711,6.71 -7.585,6.361 -3.851,-0.337 -6.699,-3.733 -6.362,-7.584 L 91.729,107.227 41.16,79.534 10.482,97.246 9.212,154.965 69.49,183.06 c 3.504,1.632 5.021,5.797 3.388,9.301 -1.633,3.503 -5.796,5.022 -9.302,3.388 L 8.875,170.254 8.088,205.979 51.35,224.996 c 3.54,1.556 5.147,5.686 3.591,9.225 -1.556,3.538 -5.686,5.148 -9.224,3.591 L 7.755,221.125 7,255.404 c 0,3.867 -3.134,7 -7,7 -3.866,0 -7,-3.133 -7,-7 l -0.746,-34.282 -37.972,16.69 c -3.538,1.557 -7.67,-0.053 -9.224,-3.591 -1.556,-3.539 0.051,-7.669 3.591,-9.225 l 43.276,-19.022 -0.778,-35.73 -54.724,25.505 c -3.506,1.633 -7.668,0.116 -9.302,-3.388 -1.633,-3.504 -0.116,-7.669 3.388,-9.301 L -9.186,154.953 -10.439,97.27 -41.15,79.54 l -50.579,27.694 5.802,66.183 c 0.337,3.851 -2.51,7.247 -6.362,7.584 -3.858,0.347 -7.248,-2.511 -7.585,-6.361 l -5.266,-60.063 -31.334,17.157 5.159,46.941 c 0.422,3.843 -2.351,7.301 -6.194,7.722 -3.83,0.425 -7.3,-2.349 -7.722,-6.193 l -4.528,-41.196 -30.065,16.463 c -3.348,1.932 -7.629,0.785 -9.563,-2.563 -1.932,-3.347 -0.785,-7.629 2.563,-9.561 l 29.336,-17.773 -33.46,-24.553 c -3.116,-2.288 -3.789,-6.668 -1.502,-9.785 1.371,-1.869 3.496,-2.859 5.649,-2.859 1.438,0 2.888,0.441 4.136,1.356 l 38.14,27.987 30.575,-18.524 -49.5,-34.675 c -3.166,-2.217 -3.935,-6.583 -1.717,-9.749 1.362,-1.944 3.533,-2.984 5.739,-2.984 1.387,0 2.788,0.411 4.011,1.267 L -100.864,91.269 -51.729,61.5 V 26.002 l -49.316,-30.013 -54.373,38.087 c -3.164,2.219 -7.529,1.449 -9.749,-1.718 -2.218,-3.166 -1.449,-7.531 1.718,-9.749 l 49.346,-34.566 -30.509,-18.567 -38.053,27.922 c -3.118,2.289 -7.499,1.614 -9.785,-1.502 -2.287,-3.117 -1.614,-7.498 1.502,-9.785 l 33.399,-24.508 -29.275,-17.817 c -3.348,-1.933 -4.495,-6.215 -2.563,-9.562 1.297,-2.246 3.65,-3.501 6.07,-3.501 1.187,0 2.39,0.302 3.493,0.938 l 30.057,16.537 4.536,-41.27 c 0.393,-3.583 3.425,-6.237 6.949,-6.237 0.256,0 0.513,0.015 0.773,0.043 3.843,0.422 6.616,3.88 6.194,7.723 l -5.17,47.048 31.329,17.236 5.282,-60.249 c 0.319,-3.643 3.376,-6.388 6.966,-6.388 0.204,0 0.411,0.008 0.619,0.026 3.852,0.338 6.699,3.733 6.362,7.585 l -5.821,66.402 50.276,27.66 30.91,-17.845 1.299,-57.635 -60.228,-28.071 c -3.504,-1.633 -5.021,-5.798 -3.388,-9.302 1.188,-2.548 3.712,-4.045 6.35,-4.045 0.989,0 1.996,0.212 2.952,0.657 l 54.659,25.476 0.805,-35.717 -43.238,-19.006 c -3.54,-1.556 -5.147,-5.685 -3.591,-9.225 1.153,-2.623 3.719,-4.185 6.412,-4.185 0.94,0 1.896,0.191 2.812,0.594 l 37.946,16.679 0.772,-34.271 c 0,-3.866 3.134,-7 7,-7 3.866,0 7,3.134 7,7 l 0.729,34.291 37.988,-16.699 c 0.916,-0.404 1.872,-0.594 2.812,-0.594 2.693,0 5.26,1.562 6.412,4.185 1.556,3.54 -0.051,7.669 -3.59,9.225 l -43.301,19.034 0.759,35.739 54.767,-25.526 c 0.957,-0.446 1.962,-0.657 2.952,-0.657 2.637,0 5.162,1.497 6.35,4.045 1.633,3.504 0.116,7.669 -3.388,9.302 l -60.356,28.13 1.22,57.456 30.797,17.781 50.578,-27.695 -5.803,-66.183 c -0.337,-3.852 2.511,-7.247 6.362,-7.585 0.208,-0.018 0.414,-0.026 0.619,-0.026 3.59,0 6.646,2.745 6.966,6.388 l 5.267,60.064 31.333,-17.158 -5.159,-46.941 c -0.422,-3.843 2.351,-7.301 6.194,-7.723 0.26,-0.028 0.517,-0.043 0.773,-0.043 3.523,0 6.556,2.654 6.949,6.237 l 4.528,41.197 30.066,-16.464 c 1.103,-0.636 2.306,-0.938 3.493,-0.938 2.419,0 4.773,1.256 6.07,3.501 1.932,3.347 0.785,7.629 -2.563,9.562 l -29.336,17.773 33.459,24.552 c 3.116,2.287 3.789,6.668 1.502,9.785 -2.286,3.117 -6.667,3.791 -9.785,1.502"]},earth:{transform:"matrix(0.35277777,0,0,-0.35277777,60.624366,132.24034)",d:["m 0,0 c -0.423,-4 -4.892,-6.179 -8.264,-3.987 -24.283,15.779 -85.571,80.677 -11.571,162.809 73.487,81.563 169.567,37.861 265.702,95.873 2.907,1.755 6.665,0.165 7.401,-3.15 13.134,-59.172 20.961,-187.976 -39.103,-247.223 -73.5,-72.5 -133.5,-40.5 -166,-29 -1.5,-18 4.501,-41.921 9.501,-58.421 5,-16.5 -27.001,-21.079 -31.001,-18.079 -4,3 -18.611,83.753 18.5,133 47.5,63.032 163,118 166.5,162.5 -22.5,-20 -51.809,-46.518 -129,-89.5 C 14.221,66.711 2.036,19.224 0,0"]},air:{transform:"",d:["m 20.688488,108.37995 c -0.487826,-0.10197 -0.465777,-0.80891 0.02756,-0.87368 4.4111,-0.5898 15.013728,-0.97289 28.807886,5.52594 18.344445,8.64305 47.966756,27.9535 65.510566,26.90481 14.83458,-0.88745 22.05963,-6.46575 21.27277,-13.32287 -0.61736,-5.37986 -6.61458,-8.90764 -11.20069,-7.14375 -4.58611,1.76389 -6.61458,5.90903 -6.26181,9.78958 -3.88055,-2.99861 -2.46944,-8.81944 -1.23472,-10.40694 1.23472,-1.5875 8.00503,-10.8176 19.57917,-2.82222 9.70139,6.70278 5.60035,19.76106 0,24.69444 -3.70417,3.2632 -14.81667,11.46528 -35.80695,6.17361 -20.990276,-5.29166 -43.620421,-24.4588 -55.562499,-30.1625 -10.991233,-5.24895 -15.72617,-6.37893 -25.131284,-8.35642","m 52.230405,106.05382 c -0.343133,-0.18741 -0.126781,-0.70969 0.246669,-0.59531 7.845171,2.39503 27.789516,6.9081 42.202418,3.16397 21.048158,-5.46805 24.870838,-17.991663 45.861108,-28.162962 13.38765,-6.487806 30.86806,-1.823145 35.63056,11.229631 4.7625,13.052781 -7.64398,22.048611 -17.4625,21.519451 -8.10424,-0.43547 -13.57919,-5.06429 -14.64028,-8.82634 -1.17684,-4.16719 0.46991,-9.575991 5.29167,-11.105611 -1.41111,6.35 2.04087,13.292561 9.17222,12.876391 7.05556,-0.41065 13.28704,-9.250771 6.70278,-15.875001 -6.59529,-6.633877 -14.81667,-5.349543 -19.75556,-2.293055 -5.26686,3.260439 -17.63889,15.522226 -28.22222,20.637496 -10.15752,4.90858 -25.033443,10.26501 -40.41648,6.17362 -13.106524,-3.48368 -17.129016,-4.64675 -24.610385,-8.74228","m 32.342558,94.131028 c -0.445107,-0.170869 -0.305926,-0.83646 0.170875,-0.81717 6.042699,0.24529 22.947094,-0.0317 31.82717,-9.914986 10.936111,-12.170834 8.445997,-20.473515 18.168056,-29.280556 6.790972,-6.150183 22.320081,-8.109755 33.249301,1.234722 12.17084,10.406945 5.70233,30.721985 -6.38031,36.98379 -10.23056,5.30131 -23.07663,3.58565 -25.987047,-4.704623 -3.241146,-9.231477 3.439583,-17.374306 10.230556,-17.286111 7.161661,0.0937 6.173611,7.231944 6.173611,7.231944 0,0 -2.11667,-3.701411 -5.027083,-3.263194 -3.689008,0.556725 -6.943934,5.177289 -5.027084,9.789583 2.38125,5.732639 12.621457,8.270981 19.989817,-0.46991 7.58473,-8.995834 5.93935,-21.225923 -6.58426,-25.635646 -11.575522,-4.074858 -18.36236,4.462089 -24.518057,15.877756 -4.850694,8.993078 -10.31875,20.458351 -26.9875,21.418851 -12.219065,0.7028 -16.949868,-0.26321 -19.298045,-1.16445"]},light:{transform:"matrix(0.35277777,0,0,-0.35277777,141.35502,111.71516)",d:["m 0,0 -9.044,27.255 23.505,9.418 -23.504,9.418 9.042,27.252 61.997,-36.673 z m 8.504,-92.473 -69.776,17.889 12.869,25.65 23.279,-9.961 -9.961,23.28 25.675,12.882 z m -129.142,-53.492 -36.693,61.957 27.222,9.032 9.418,-23.503 9.417,23.503 27.262,-9.045 z m -129.142,53.492 17.848,69.718 25.633,-12.86 -9.96,-23.28 23.279,9.961 12.875,-25.661 z m -53.492,129.143 61.897,36.648 9.034,-27.228 -23.504,-9.417 23.504,-9.417 -9.035,-27.232 z m 53.492,129.142 69.674,-17.875 -12.874,-25.658 -23.279,9.961 9.96,-23.279 -25.634,-12.86 z m 129.142,53.493 36.625,-61.939 -27.26,-9.046 -9.418,23.505 -9.418,-23.505 -27.221,9.033 z m 66.4,-155.106 14.078,32.9 26.922,-15.926 -7.78,-30.284 z m 0,-55.053 33.22,13.311 7.78,-30.287 -26.922,-15.924 z m -38.928,-38.927 32.902,-14.078 -15.909,-26.906 -30.302,7.769 z m -55.052,0 13.31,-33.217 -30.267,-7.766 -15.936,26.909 z m -38.927,38.927 -14.076,-32.895 -26.889,15.92 7.753,30.283 z m 0,55.053 -33.212,-13.307 -7.753,30.281 26.889,15.921 z m 38.927,38.928 -32.893,14.074 15.935,26.906 30.267,-7.764 z m 55.052,0 -13.308,33.213 30.302,7.767 15.908,-26.902 z m 101.67,62.685 -17.913,-69.733 -25.676,12.882 9.961,23.279 -23.279,-9.961 -12.868,25.648 z M 98.306,42.036 5.124,88.788 37.955,187.735 c 0.715,2.155 0.153,4.528 -1.452,6.132 -1.605,1.605 -3.98,2.171 -6.132,1.452 l -98.947,-32.831 -46.752,93.183 c -1.019,2.029 -3.094,3.309 -5.363,3.309 -2.27,0 -4.345,-1.28 -5.364,-3.309 l -46.752,-93.183 -98.947,32.831 c -2.153,0.718 -4.528,0.153 -6.132,-1.452 -1.605,-1.604 -2.167,-3.977 -1.452,-6.132 l 32.83,-98.948 -93.181,-46.751 c -2.03,-1.018 -3.31,-3.094 -3.31,-5.363 0,-2.27 1.28,-4.345 3.31,-5.363 l 93.181,-46.751 -32.83,-98.949 c -0.715,-2.154 -0.153,-4.527 1.452,-6.131 1.605,-1.605 3.978,-2.169 6.132,-1.453 l 98.947,32.831 46.752,-93.182 c 1.019,-2.029 3.094,-3.31 5.364,-3.31 2.269,0 4.344,1.281 5.363,3.31 l 46.751,93.182 98.948,-32.831 c 0.619,-0.206 1.257,-0.305 1.889,-0.305 1.566,0 3.1,0.614 4.243,1.758 1.605,1.604 2.167,3.977 1.452,6.131 L 5.123,-15.442 98.306,31.31 c 2.029,1.018 3.309,3.093 3.309,5.363 0,2.269 -1.28,4.345 -3.309,5.363"]},dark:{transform:"matrix(0.35277777,0,0,-0.35277777,114.94562,150.20756)",d:["m 0,0 c -8.87,0 -17.561,0.8 -26,2.32 6.06,2.781 11.92,5.941 17.54,9.441 1.786,1.112 3.539,2.271 5.276,3.453 73.09,1.203 131.963,59.194 131.963,130.566 0,71.385 -58.877,129.378 -131.971,130.577 -1.739,1.181 -3.492,2.34 -5.279,3.454 -5.619,3.5 -11.469,6.659 -17.529,9.439 8.439,1.521 17.13,2.32 26,2.32 80.38,0 145.779,-65.4 145.779,-145.79 C 145.779,65.4 80.38,0 0,0 M -45.83,7.38 C -52.25,5.24 -58.88,3.55 -65.66,2.32 -74.1,0.8 -82.78,0 -91.65,0 c -80.39,0 -145.79,65.4 -145.79,145.78 0,80.39 65.4,145.79 145.79,145.79 8.87,0 17.55,-0.799 25.99,-2.32 6.78,-1.229 13.41,-2.92 19.83,-5.06 6.019,-1.99 11.87,-4.379 17.51,-7.11 48.75,-23.61 82.45,-73.59 82.45,-131.3 0,-57.7 -33.7,-107.679 -82.45,-131.29 -5.64,-2.729 -11.491,-5.12 -17.51,-7.11 M 0,303.57 c -15.93,0 -31.311,-2.37 -45.82,-6.79 -14.51,4.42 -29.901,6.79 -45.83,6.79 -87.01,0 -157.79,-70.78 -157.79,-157.79 0,-87 70.78,-157.78 157.79,-157.78 15.929,0 31.32,2.37 45.83,6.79 C -31.311,-9.63 -15.93,-12 0,-12 87,-12 157.779,58.78 157.779,145.78 157.779,232.79 87,303.57 0,303.57"]}};ngOnInit(){this.appContext.elements$.subscribe(t=>{const o=t.find(n=>n.type===this.element.type);o&&(this.element={...o})})}get fillUrl(){return`url(#${this.element.type}-${this.element.state})`}toggleColor(){const t=this.element.state===u.e_.None?u.e_.Full:this.element.state===u.e_.Full?u.e_.Half:u.e_.None;this.appContext.setElementState(this.element.type,t),this.element={...this.element,state:t}}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B))};static \u0275cmp=e.VBU({type:i,selectors:[["app-element"]],inputs:{element:"element"},decls:15,vars:14,consts:[[1,"element-container"],["viewBox","0 0 197.55556 197.55556","xmlns","http://www.w3.org/2000/svg",1,"element-icon",3,"click"],["x1","0%","y1","100%","x2","0%","y2","0%"],["offset","50%",2,"stop-opacity","0.75"],["x1","0%","y1","100%"],["offset","190%",2,"stop-opacity","1"],["d","m 98.77778,194.73333 c -25.630363,0 -49.727202,-9.98114 -67.850807,-28.10475 C 12.803368,148.50498 2.8222266,124.40814 2.8222266,98.777777 2.8222266,73.14706 12.803368,49.050575 30.926973,30.92697 49.050578,12.803365 73.147417,2.8222231 98.77778,2.8222231 c 25.63036,0 49.7272,9.9811419 67.85081,28.1047469 18.1236,18.123605 28.10474,42.22009 28.10474,67.850807 0,25.630363 -9.98114,49.727203 -28.10474,67.850803 -18.12361,18.12361 -42.22045,28.10475 -67.85081,28.10475"],["transform","matrix(0.35277777,0,0,-0.35277777,98.77778,1.9e-6)",1,"outline"],["d","m 0,0 c -37.793,0 -74.464,-7.405 -108.993,-22.01 -33.345,-14.104 -63.287,-34.291 -88.997,-60 -25.709,-25.71 -45.897,-55.652 -59.999,-88.996 C -272.595,-205.537 -280,-242.207 -280,-280 c 0,-37.793 7.405,-74.464 22.011,-108.993 14.102,-33.345 34.29,-63.287 59.999,-88.997 25.71,-25.709 55.652,-45.897 88.997,-59.999 C -74.464,-552.595 -37.793,-560 0,-560 c 37.793,0 74.464,7.405 108.993,22.011 33.345,14.102 63.287,34.29 88.997,59.999 25.709,25.71 45.897,55.652 59.999,88.997 14.606,34.529 22.011,71.2 22.011,108.993 0,37.793 -7.405,74.463 -22.011,108.994 -14.102,33.344 -34.29,63.286 -59.999,88.996 -25.71,25.709 -55.652,45.896 -88.997,60 C 74.464,-7.405 37.793,0 0,0 m 0,-16 c 145.803,0 264,-118.197 264,-264 0,-145.803 -118.197,-264 -264,-264 -145.803,0 -264,118.197 -264,264 0,145.803 118.197,264 264,264",2,"fill-opacity","1","fill-rule","nonzero","stroke","none"],[1,"symbol"],["style","fill-opacity:1;fill-rule:nonzero;stroke:none",3,"ngClass",4,"ngFor","ngForOf"],[2,"fill-opacity","1","fill-rule","nonzero","stroke","none",3,"ngClass"]],template:function(o,n){1&o&&(e.j41(0,"div",0),s.qSk(),e.j41(1,"svg",1),e.bIt("click",function(){return n.toggleColor()}),e.j41(2,"defs")(3,"linearGradient",2),e.nrm(4,"stop",3)(5,"stop",3),e.k0s(),e.j41(6,"linearGradient",4),e.nrm(7,"stop",5),e.k0s(),e.j41(8,"linearGradient",4),e.nrm(9,"stop",5),e.k0s()(),e.nrm(10,"path",6),e.j41(11,"g",7),e.nrm(12,"path",8),e.k0s(),e.j41(13,"g",9),e.DNE(14,Ie,1,5,"path",10),e.k0s()()()),2&o&&(e.R7$(3),e.BMQ("id",n.element.type+"-half"),e.R7$(),e.xc7("stop-color","var(--element-"+n.element.type+"-color)"),e.R7$(),e.xc7("stop-color","var(--element-base-color)"),e.R7$(),e.BMQ("id",n.element.type+"-full"),e.R7$(),e.xc7("stop-color","var(--element-"+n.element.type+"-color)"),e.R7$(),e.BMQ("id",n.element.type+"-none"),e.R7$(),e.xc7("stop-color","var(--element-base-color)"),e.R7$(),e.BMQ("fill",n.fillUrl),e.R7$(3),e.BMQ("transform",n.symbols[n.element.type].transform),e.R7$(),e.Y8G("ngForOf",n.symbols[n.element.type].d))},dependencies:[p.MD,p.YU,p.Sq],styles:[".element-container[_ngcontent-%COMP%]{width:50px;height:50px;display:flex;gap:8px}svg[_ngcontent-%COMP%]{background-color:var(--content-background-right);border-radius:50%}svg[_ngcontent-%COMP%]   stop[_ngcontent-%COMP%]{transition:.4s ease}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:var(--font-color-dark)}svg[_ngcontent-%COMP%]   g[_ngcontent-%COMP%]   path.dark.full[_ngcontent-%COMP%]{fill:var(--element-base-color)}.element[_ngcontent-%COMP%]{width:100%;height:100%;transform-origin:center;display:block}"]})}return i})(),A=(()=>{class i{appContext;creature;buffs=[];constructor(t){this.appContext=t}storeBuff(t,o){this.buffs.push({type:t,value:o})}publishBuffs(){this.buffs.forEach(t=>{this.appContext.updateCreatureBaseStat(this.creature.id,t.type,t.value,!0)})}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B))};static \u0275cmp=e.VBU({type:i,selectors:[["app-buffs"]],inputs:{creature:"creature"},decls:19,vars:4,consts:[[1,"buffs"],[1,"stats","base-stats"],[1,"armor","stat"],[1,"icon","shield"],["type","tel","maxlength","3",1,"stat-input",3,"blur","value"],[1,"retaliate","stat"],[1,"icon","retaliate"],[1,"stats","round-stats"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div"),e.EFF(3,"Base"),e.k0s(),e.j41(4,"div",2),e.nrm(5,"div",3),e.j41(6,"input",4),e.bIt("blur",function(a){return n.storeBuff("armor",+a.target.value)}),e.k0s()(),e.j41(7,"div",5),e.nrm(8,"div",6),e.j41(9,"input",4),e.bIt("blur",function(a){return n.storeBuff("retaliate",+a.target.value)}),e.k0s()()(),e.j41(10,"div",7)(11,"div"),e.EFF(12,"Round"),e.k0s(),e.j41(13,"div",2),e.nrm(14,"div",3),e.j41(15,"input",4),e.bIt("blur",function(a){return n.storeBuff("roundArmor",+a.target.value)}),e.k0s()(),e.j41(16,"div",5),e.nrm(17,"div",6),e.j41(18,"input",4),e.bIt("blur",function(a){return n.storeBuff("roundRetaliate",+a.target.value)}),e.k0s()()()()),2&o&&(e.R7$(6),e.Y8G("value",n.creature.armor),e.R7$(3),e.Y8G("value",n.creature.retaliate),e.R7$(6),e.Y8G("value",n.creature.roundArmor),e.R7$(3),e.Y8G("value",n.creature.roundRetaliate))},dependencies:[p.MD,v.S],styles:[".buffs[_ngcontent-%COMP%]{font-size:30px;display:flex;flex-direction:column}.buffs[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;margin:5px 0}.buffs[_ngcontent-%COMP%]   .stats.round-stats[_ngcontent-%COMP%]{border-top:5px solid}.buffs[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.buffs[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .stat-input[_ngcontent-%COMP%]{height:40px;line-height:40px}"]})}return i})();function Se(i,c){if(1&i&&e.nrm(0,"app-buffs",10),2&i){const t=e.XpG();e.Y8G("creature",t.creature)}}function Te(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",12),e.nrm(1,"div",17),e.j41(2,"input",14),e.mxI("ngModelChange",function(n){s.eBV(t);const r=e.XpG(2);return e.DH7(r.armorPen,n)||(r.armorPen=n),s.Njj(n)}),e.bIt("ngModelChange",function(){s.eBV(t);const n=e.XpG(2);return s.Njj(n.calculateDamage())}),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.R50("ngModel",t.armorPen)}}function Ee(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",11)(1,"div",12),e.nrm(2,"div",13),e.j41(3,"input",14),e.mxI("ngModelChange",function(n){s.eBV(t);const r=e.XpG();return e.DH7(r.attack,n)||(r.attack=n),s.Njj(n)}),e.bIt("ngModelChange",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.calculateDamage())}),e.k0s()(),e.DNE(4,Te,3,1,"div",15),e.j41(5,"div",16),e.EFF(6),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(3),e.R50("ngModel",t.attack),e.R7$(),e.Y8G("ngIf",t.creature.armor+t.creature.roundArmor>0),e.R7$(2),e.SpI(" total: ",t.damage||0," ")}}function $e(i,c){if(1&i){const t=e.RV6();e.j41(0,"app-conditions",18),e.bIt("conditionToggled",function(n){s.eBV(t);const r=e.XpG();return s.Njj(r.toggleCondition(n))}),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("creature",t.creature)("conditions",t.conditions)("immunities",t.creature.immunities)("shouldShowBuffs",t.shouldShowBuffs)}}let Ge=(()=>{class i{appContext;buffsComponent;creature;conditions=Object.values(u.Mm);attack=0;armorPen=0;damage=0;tempConditions=[];constructor(t){this.appContext=t,this.creature=t.selectedCreature}get shouldShowBuffs(){const{armor:t=0,roundArmor:o=0,retaliate:n=0,roundRetaliate:r=0}=this.creature??{};return t>0||o>0||n>0||r>0}toggleCondition(t){this.tempConditions.push(t)}attackCreature(){if(this.attack<=0)return;const t=this.calculateDamage(),o=this.creature.hp-t;this.appContext.updateCreatureBaseStat(this.creature.id,"hp",this.creature.hp-t),o<=0&&this.appContext.killCreature(this.creature.id)}calculateDamage(){let t=this.attack;const o=Math.max(this.creature.armor+this.creature.roundArmor-this.armorPen,0);t-=o;const n={[u.Mm.poison]:a=>a+1,[u.Mm.brittle]:a=>2*a,[u.Mm.ward]:a=>Math.floor(a/2)};return t=this.creature.conditions.filter(a=>n[a]&&t>0).map(a=>n[a]).reduce((a,l)=>l(a),t),this.damage=Math.max(t,0),this.damage}confirm(){this.attackCreature(),this.tempConditions.forEach(t=>{this.creature&&this.appContext.toggleCreatureConditions(this.creature.id,t)}),this.buffsComponent?.publishBuffs(),this.close()}close(){this.appContext.selectedCreature=null}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B))};static \u0275cmp=e.VBU({type:i,selectors:[["app-attack-modal"]],viewQuery:function(o,n){if(1&o&&e.GBs(A,5),2&o){let r;e.mGM(r=e.lsd())&&(n.buffsComponent=r.first)}},decls:13,vars:4,consts:[[1,"layout"],[1,"modal"],[1,"content"],[1,"name"],[3,"creature",4,"ngIf"],["class","attack",4,"ngIf"],[3,"creature","conditions","immunities","shouldShowBuffs","conditionToggled",4,"ngIf"],[1,"buttons"],["type","button",1,"cancel",3,"click"],["type","button",1,"confirm",3,"click"],[3,"creature"],[1,"attack"],[1,"stat"],[1,"icon","damage"],["type","tel","maxlength","3",1,"stat-input",3,"ngModelChange","ngModel"],["class","stat",4,"ngIf"],[1,"damage-preview"],[1,"icon","pierce"],[3,"conditionToggled","creature","conditions","immunities","shouldShowBuffs"]],template:function(o,n){1&o&&(e.nrm(0,"div",0),e.j41(1,"div",1)(2,"div",2)(3,"div",3),e.EFF(4),e.k0s(),e.DNE(5,Se,1,1,"app-buffs",4)(6,Ee,7,3,"div",5)(7,$e,1,4,"app-conditions",6),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return n.close()}),e.EFF(10,"Cancel"),e.k0s(),e.j41(11,"button",9),e.bIt("click",function(){return n.confirm()}),e.EFF(12,"Confirm"),e.k0s()()()()),2&o&&(e.R7$(4),e.SpI("",n.appContext.isGroupSelected&&n.creature.aggressive?n.creature.type:n.creature.name," "),e.R7$(),e.Y8G("ngIf",n.appContext.isGroupSelected),e.R7$(),e.Y8G("ngIf",!n.appContext.isGroupSelected),e.R7$(),e.Y8G("ngIf",!n.appContext.isGroupSelected))},dependencies:[p.MD,p.bT,N,v.S,A,_.YN,_.me,_.BC,_.tU,_.vS],styles:[".modal[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:root.no-scroll, .modal[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:root.no-scroll   body[_ngcontent-%COMP%]{overflow:hidden;touch-action:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{box-shadow:0 0 0 3px var(--content-box-shadow-1),0 0 4px 3px var(--content-box-shadow-2),inset 0 0 7px 0 var(--content-box-shadow-3),3px 3px 1px 1px var(--content-box-shadow-4),-3px 3px 1px 1px var(--content-box-shadow-4);padding:15px;gap:.5rem;display:flex;flex-direction:column}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:35px}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:.5rem}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .damage-preview[_ngcontent-%COMP%]{margin-top:.1em;margin-bottom:.1em}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .icon.damage[_ngcontent-%COMP%]{height:55px}"]})}return i})();var R=m(4412),F=m(4572),Be=m(9172),k=m(6354);let y=(()=>{class i{expanded=!1;toggle=new e.bkB;static \u0275fac=function(o){return new(o||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-chevron-toggle"]],inputs:{expanded:"expanded"},outputs:{toggle:"toggle"},decls:3,vars:1,consts:[["tabindex","0","role","button",1,"chevron",3,"click","ngClass"],["viewBox","0 0 24 24","stroke","currentColor","stroke-width","2","fill","none","stroke-linecap","round","stroke-linejoin","round"],["points","6 9 12 15 18 9"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.bIt("click",function(){return n.toggle.emit()}),s.qSk(),e.j41(1,"svg",1),e.nrm(2,"polyline",2),e.k0s()()),2&o&&e.Y8G("ngClass",n.expanded?"expanded":"")},dependencies:[p.MD,p.YU],styles:[".chevron[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;cursor:pointer;transition:transform .2s ease,color .2s ease;outline:none;color:var(--font-color);border-radius:4px;flex-shrink:0}.chevron.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.chevron[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}"]})}return i})();var Xe=m(8147);function De(i,c){if(1&i&&(e.j41(0,"option",12),e.EFF(1),e.k0s()),2&i){const t=c.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.text)}}function Ne(i,c){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"select",10),e.bIt("change",function(n){s.eBV(t);const r=e.XpG(2);return s.Njj(r.onFilterChange(n))}),e.DNE(2,De,2,2,"option",11),e.k0s(),e.bVm()}if(2&i){const t=e.XpG().ngIf;e.R7$(2),e.Y8G("ngForOf",t)}}function Ae(i,c){if(1&i&&(e.j41(0,"div",8),e.DNE(1,Ne,3,1,"ng-container",9),e.k0s()),2&i){const t=c.ngIf;e.R7$(),e.Y8G("ngIf",t.length)}}function Ye(i,c){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td")(10,"button",13),e.bIt("click",function(){const n=s.eBV(t).$implicit,r=e.XpG();return s.Njj(r.undo(n))}),e.k0s()()()}if(2&i){const t=c.$implicit;e.R7$(2),e.JRh(t.time),e.R7$(2),e.JRh(t.creature),e.R7$(2),e.JRh(t.stat),e.R7$(2),e.JRh(t.value)}}function Le(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",14)(1,"button",15),e.bIt("click",function(){const n=s.eBV(t).ngIf,r=e.XpG();return s.Njj(r.prevPage(n))}),e.EFF(2,"Prev"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s(),e.j41(5,"button",15),e.bIt("click",function(){const n=s.eBV(t).ngIf,r=e.XpG();return s.Njj(r.nextPage(n))}),e.EFF(6,"Next"),e.k0s()()}if(2&i){const t=c.ngIf,o=e.XpG();e.R7$(),e.Y8G("disabled",1===o.currentPage$.value),e.R7$(3),e.Lme("Page ",o.currentPage$.value," / ",t),e.R7$(),e.Y8G("disabled",o.currentPage$.value===t)}}let Ve=(()=>{class i{logService;appContext;notificationService;pageSize=10;shouldShowLog=!0;defaultUpdate;undoHandlers;currentPage$=new R.t(1);selectedIds$=new R.t([]);characters$;filteredAll$;totalPages$;filteredLogs$;constructor(t,o,n){this.logService=t,this.appContext=o,this.notificationService=n,this.characters$=this.logService.characterOptions$,this.filteredAll$=(0,F.z)([this.logService.logs$,this.selectedIds$.pipe((0,Be.Z)([]))]).pipe((0,k.T)(([r,a])=>{if(!a||0===a.length)return r;const l=new Set(a);return r.filter(d=>!!d.creatureId&&l.has(d.creatureId))})),this.totalPages$=this.filteredAll$.pipe((0,k.T)(r=>Math.max(1,Math.ceil(r.length/this.pageSize)))),this.filteredLogs$=(0,F.z)([this.filteredAll$,this.currentPage$]).pipe((0,k.T)(([r,a])=>{const l=(a-1)*this.pageSize;return r.slice(l,l+this.pageSize)})),this.defaultUpdate=(r,a,l)=>{if(l.stat){const d=["armor","roundArmor","retaliate","roundRetaliate"].includes(l.stat);this.appContext.updateCreatureBaseStat(r,l.stat,a,d);const f=Array.isArray(a)&&0===a.length?`${l.stat} restored to default`:`${l.stat} restored to ${a}`;this.notificationService.emitInfoMessage(f)}},this.undoHandlers={killed:(r,a,l)=>{const d=this.logService.getLastAliveHpBefore(l.id,r),g=l.data?.old?.hp,f=this.logService.getLastPositiveHp(r);this.appContext.reviveCreature(r,d??(g&&g>0?g:void 0)??f??1)},created:r=>{this.appContext.killCreature&&this.appContext.killCreature(r)},sessionExperience:(r,a)=>{this.appContext.updateCreatureBaseStat(r,"sessionExperience",a);const l=this.appContext.getCreatures().find(d=>d.id===r)?.totalXp??0;this.appContext.updateCreatureBaseStat(r,"totalXp",l-1)}}}onFilterChange(t){const n=Array.from(t.target.selectedOptions).map(r=>r.value);this.currentPage$.next(1),this.selectedIds$.next(n)}prevPage(t){const o=this.currentPage$.value;o>1&&this.currentPage$.next(o-1)}nextPage(t){const o=this.currentPage$.value;o<t&&this.currentPage$.next(o+1)}undo(t){const o=t.creatureId;o&&(this.undoHandlers[t.stat]??this.defaultUpdate)(o,t.oldValue,t)}static \u0275fac=function(o){return new(o||i)(e.rXU(Xe.K),e.rXU(C.B),e.rXU(P.J))};static \u0275cmp=e.VBU({type:i,selectors:[["app-log"]],decls:25,vars:12,consts:[[1,"log-container"],["role","button","tabindex","0",3,"click"],[3,"toggle","expanded"],[1,"log-content"],["class","log-filter",4,"ngIf"],[1,"log-table"],[4,"ngFor","ngForOf"],["class","pager",4,"ngIf"],[1,"log-filter"],[4,"ngIf"],["multiple","",3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"icon","undo",3,"click"],[1,"pager"],[3,"click","disabled"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"h3",1),e.bIt("click",function(){return n.shouldShowLog=!n.shouldShowLog}),e.EFF(2,"Audit History"),e.k0s(),e.j41(3,"app-chevron-toggle",2),e.bIt("toggle",function(){return n.shouldShowLog=!n.shouldShowLog}),e.k0s(),e.j41(4,"div",3),e.DNE(5,Ae,2,1,"div",4),e.nI1(6,"async"),e.j41(7,"table",5)(8,"thead")(9,"tr")(10,"th"),e.EFF(11,"When"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Who"),e.k0s(),e.j41(14,"th"),e.EFF(15,"What"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Is"),e.k0s(),e.j41(18,"th"),e.EFF(19,"Shit"),e.k0s()()(),e.j41(20,"tbody"),e.DNE(21,Ye,11,4,"tr",6),e.nI1(22,"async"),e.k0s()(),e.DNE(23,Le,7,4,"div",7),e.nI1(24,"async"),e.k0s()()),2&o&&(e.R7$(3),e.Y8G("expanded",n.shouldShowLog),e.R7$(),e.xc7("display",n.shouldShowLog?null:"none"),e.R7$(),e.Y8G("ngIf",e.bMT(6,6,n.characters$)),e.R7$(16),e.Y8G("ngForOf",e.bMT(22,8,n.filteredLogs$)),e.R7$(2),e.Y8G("ngIf",e.bMT(24,10,n.totalPages$)))},dependencies:[p.MD,p.Sq,p.bT,y,p.Jj],styles:[".log-container[_ngcontent-%COMP%]{display:block;overflow-x:auto}.log-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.log-container[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;margin-right:.5rem}.log-container[_ngcontent-%COMP%]   .log-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:15px;table-layout:fixed}.log-container[_ngcontent-%COMP%]   .log-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .log-container[_ngcontent-%COMP%]   .log-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;text-align:left;border-bottom:1px solid var(--font-color)}.log-container[_ngcontent-%COMP%]   .log-filter[_ngcontent-%COMP%]{width:100%;margin:1rem 0;display:flex;align-items:center;gap:1rem}.log-container[_ngcontent-%COMP%]   .log-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:14px;color:var(--font-color)}.log-container[_ngcontent-%COMP%]   .log-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;min-height:2.5rem;padding:.5rem;border:1px solid var(--font-color);border-radius:6px;font-size:16px;background-color:var(--background-color);color:var(--font-color, #333)}.log-container[_ngcontent-%COMP%]   .log-filter[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{cursor:pointer;padding:6px 10px;font-size:16px}.log-container[_ngcontent-%COMP%]   .log-filter[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:hover{background-color:var(--background-secondary, var(--secondary-color));color:#000}.log-container[_ngcontent-%COMP%]   .pager[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;justify-content:flex-end;margin-top:.5rem;font-size:15px}.log-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--font-color);background-color:var(--background-color);border:1px solid var(--font-color);border-radius:4px;padding:.25rem .75rem;cursor:pointer;font-size:13px}.log-container[_ngcontent-%COMP%]   button.undo[_ngcontent-%COMP%]{border:none;width:20px;height:20px}.log-content[_ngcontent-%COMP%]{display:block}.log-container[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;transition:opacity .2s ease}.log-container[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]:hover{opacity:.8}"]})}return i})();var $=m(5231);function Ue(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",20),e.bIt("mousedown",function(n){return s.eBV(t),s.Njj(n.preventDefault())})("click",function(){const n=s.eBV(t).$implicit,r=e.XpG(2);return s.Njj(r.selectMonster(n))}),e.EFF(1),e.k0s()}if(2&i){const t=c.$implicit;e.R7$(),e.SpI(" ",t.name," ")}}function He(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",15),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.closePicker())}),e.j41(1,"div",16),e.bIt("click",function(n){return s.eBV(t),s.Njj(n.stopPropagation())}),e.j41(2,"button",17),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.closePicker())}),e.EFF(3," \u2715 "),e.k0s(),e.j41(4,"div",18),e.DNE(5,Ue,2,1,"div",19),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(5),e.Y8G("ngForOf",t.filteredMonsters)}}let ze=(()=>{class i{appContext;dataLoader;creatureFactory;notificationService;monsterEvent=new e.bkB;level=1;standee=1;isElite=!1;type="";pickerOpen=!1;monsters=[];filteredMonsters=[];constructor(t,o,n,r){this.appContext=t,this.dataLoader=o,this.creatureFactory=n,this.notificationService=r,this.monsters=this.dataLoader.getData().monsters.sort((a,l)=>a.name.toLowerCase().localeCompare(l.name.toLowerCase())),this.appContext.defaultLevel$.subscribe(a=>{this.level=a})}addMonster(){this.type?(this.appContext.addCreature(this.creatureFactory.createCreature({type:this.type,standee:this.standee,level:this.level,isElite:this.isElite,aggressive:!0})),this.monsterEvent.emit("monster-added"),this.notificationService.emitInfoMessage(`${this.type} added successfully!`)):this.notificationService.emitErrorMessage("Please select a monster type.")}openPicker(){this.pickerOpen=!0,this.filteredMonsters=this.monsters.slice(),document.documentElement.classList.add("no-scroll")}closePicker(){this.pickerOpen=!1,this.filteredMonsters=[],document.documentElement.classList.remove("no-scroll")}onTypeInput(){const t=(this.type||"").toLowerCase().trim();this.filteredMonsters=t?this.monsters.filter(o=>o.name.toLowerCase().includes(t)):this.monsters.slice()}selectMonster(t){this.type=t.name,this.closePicker()}closeModal(){this.appContext.addMonsterToggled=!1}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B),e.rXU(I.X),e.rXU($.Z),e.rXU(P.J))};static \u0275cmp=e.VBU({type:i,selectors:[["app-add-monster"]],outputs:{monsterEvent:"monsterEvent"},decls:23,vars:4,consts:[[1,"layout"],[1,"modal"],[1,"content"],[1,"title"],[1,"form-row"],["for","type"],["id","type","type","text","autocomplete","off","inputmode","search","autocapitalize","off","autocorrect","off","placeholder","Select\u2026","onfocus","if(this.value) this.value=''",3,"ngModelChange","input","focus","ngModel"],["class","monster-picker-overlay",3,"click",4,"ngIf"],["for","Standee"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],["for","Elite"],["type","checkbox","id","elite-monster",3,"ngModelChange","ngModel"],[1,"buttons"],["type","button",1,"cancel",3,"click"],["type","button",1,"confirm",3,"click"],[1,"monster-picker-overlay",3,"click"],[1,"monster-picker-sheet",3,"click"],["type","button","aria-label","Close monster picker",1,"picker-close",3,"click"],[1,"monster-type-list"],["class","monster-type-item",3,"mousedown","click",4,"ngFor","ngForOf"],[1,"monster-type-item",3,"mousedown","click"]],template:function(o,n){1&o&&(e.nrm(0,"div",0),e.j41(1,"div",1)(2,"div",2)(3,"div",3),e.EFF(4,"Add Monster"),e.k0s(),e.j41(5,"div",4)(6,"label",5),e.EFF(7,"Type"),e.k0s(),e.j41(8,"input",6),e.mxI("ngModelChange",function(a){return e.DH7(n.type,a)||(n.type=a),a}),e.bIt("input",function(){return n.onTypeInput()})("focus",function(){return n.openPicker()}),e.k0s()(),e.DNE(9,He,6,1,"div",7),e.j41(10,"div",4)(11,"label",8),e.EFF(12,"Standee"),e.k0s(),e.j41(13,"input",9),e.mxI("ngModelChange",function(a){return e.DH7(n.standee,a)||(n.standee=a),a}),e.k0s()(),e.j41(14,"div",4)(15,"label",10),e.EFF(16,"Elite"),e.k0s(),e.j41(17,"input",11),e.mxI("ngModelChange",function(a){return e.DH7(n.isElite,a)||(n.isElite=a),a}),e.k0s()(),e.j41(18,"div",12)(19,"button",13),e.bIt("click",function(){return n.closeModal()}),e.EFF(20,"Close"),e.k0s(),e.j41(21,"button",14),e.bIt("click",function(){return n.addMonster()}),e.EFF(22,"Confirm"),e.k0s()()()()),2&o&&(e.R7$(8),e.R50("ngModel",n.type),e.R7$(),e.Y8G("ngIf",n.pickerOpen),e.R7$(4),e.R50("ngModel",n.standee),e.R7$(4),e.R50("ngModel",n.isElite))},dependencies:[p.MD,p.Sq,p.bT,_.YN,_.me,_.Zm,_.BC,_.vS,v.S],styles:[".modal[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.modal[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:root.no-scroll, .modal[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:root.no-scroll   body[_ngcontent-%COMP%]{overflow:hidden;touch-action:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;text-align:left}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;text-align:center;width:100%;margin-bottom:1rem;justify-content:center}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100px;font-weight:600;text-align:right}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%]{flex:1;margin-bottom:0;width:100%}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   div.form-row[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:20px;height:20px;vertical-align:middle}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .monster-picker-sheet[_ngcontent-%COMP%]{width:100%;max-width:640px;margin:0 auto;background:var(--background);max-height:50dvh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 -8px 24px #0000004d}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .monster-type-list[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0;overflow-y:auto;overscroll-behavior:contain;padding:.25rem 0;border-top:none;max-height:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .monster-type-item[_ngcontent-%COMP%]{padding:.6rem .8rem;cursor:pointer;-webkit-tap-highlight-color:transparent;border-bottom:1px solid color-mix(in oklab,var(--secondary-color) 40%,transparent)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .monster-type-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .monster-type-item[_ngcontent-%COMP%]:hover{background:var(--secondary-color)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .monster-type-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .picker-close[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;height:40px;min-width:40px;border-radius:8px;border:1px solid var(--secondary-color);color:var(--base-color-spots)}.modal[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:.5rem;margin-top:1rem}@media (max-width: 768px){.modal[_ngcontent-%COMP%]{top:10%;width:90%}.monster-type-list[_ngcontent-%COMP%]{max-height:45dvh}.monster-picker-overlay[_ngcontent-%COMP%]{place-items:center}.monster-picker-sheet[_ngcontent-%COMP%]{border-radius:16px;max-height:80dvh}}"]})}return i})();var Y=m(3077);let L=(()=>{class i{localStorage;CHAR_KEY="initiative_char_type";selectedCharacterTypeSubject=new R.t(null);selectedCharacterType$=this.selectedCharacterTypeSubject.asObservable();pendingInitiativeSubject=new R.t(null);pendingInitiative$=this.pendingInitiativeSubject.asObservable();constructor(t){this.localStorage=t;const o=this.localStorage.load(this.CHAR_KEY);o&&this.selectedCharacterTypeSubject.next(o)}getSelectedCharacterType(){return this.selectedCharacterTypeSubject.getValue()}selectCharacter(t){t?this.localStorage.set(this.CHAR_KEY,JSON.stringify(t)):this.localStorage.clear(this.CHAR_KEY),this.selectedCharacterTypeSubject.next(t)}getPendingInitiative(){return this.pendingInitiativeSubject.getValue()}setPendingInitiative(t){this.pendingInitiativeSubject.next(t)}onRoundAdvanced(){this.pendingInitiativeSubject.next(null)}static \u0275fac=function(o){return new(o||i)(s.KVO(Y.s))};static \u0275prov=s.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Je=(()=>{class i{appContext;initiativeService;roundNumber=1;roundAdvanced=new e.bkB;elements=[];sub;constructor(t,o){this.appContext=t,this.initiativeService=o}ngOnInit(){this.sub=this.appContext.roundNumber$.subscribe(t=>{this.roundNumber=t})}ngOnDestroy(){this.sub?.unsubscribe()}nextRound(){this.resetAllCreatures(),this.applyPendingInitiative(),this.resetElements();const t=this.roundNumber+1;this.roundNumber=t,this.appContext.setRoundNumber(t),this.roundAdvanced.emit(t),this.initiativeService.onRoundAdvanced()}applyPendingInitiative(){const t=this.initiativeService.getPendingInitiative(),o=this.initiativeService.getSelectedCharacterType();if(null===t||!o)return;const n=this.appContext.getCreatures().find(r=>r.type===o&&!r.aggressive);n?.id&&this.appContext.updateCreatureBaseStat(n.id,"initiative",t,!1)}resetAllCreatures(){const t=this.appContext.getCreatures().map(o=>({...o,initiative:0,roundArmor:0,roundRetaliate:0}));this.appContext.setCreatures(t)}resetElements(){const t=this.appContext.getElements().map(o=>{let n;return n=o.state===u.e_.Half?u.e_.None:o.state===u.e_.Full?u.e_.Half:o.state,{...o,state:n}});this.appContext.setElements(t)}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B),e.rXU(L))};static \u0275cmp=e.VBU({type:i,selectors:[["app-round"]],inputs:{elements:"elements"},outputs:{roundAdvanced:"roundAdvanced"},decls:5,vars:1,consts:[[1,"section"],[1,"cancel",3,"click"]],template:function(o,n){1&o&&(e.rj2(0,"div",0)(1,"div"),e.EFF(2),e.eux(),e.rj2(3,"button",1),e.VwU("click",function(){return n.nextRound()}),e.EFF(4," Next "),e.eux()()),2&o&&(e.R7$(2),e.SpI(" Round ",n.roundNumber," "))},dependencies:[p.MD],styles:[".section[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;gap:1rem;align-items:center;border-left:5px solid;padding-left:1rem}.section[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]})}return i})();var G=m(467),M=m(4242);function Qe(i,c){if(1&i&&(e.j41(0,"div",8)(1,"h3"),e.EFF(2),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(2),e.JRh(t.title)}}function We(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",1),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.onBackdropClick())}),e.j41(1,"div",2),e.bIt("click",function(n){return s.eBV(t),s.Njj(n.stopPropagation())}),e.DNE(2,Qe,3,1,"ng-template",3),e.j41(3,"div",4)(4,"p"),e.EFF(5),e.k0s()(),e.j41(6,"div",5)(7,"button",6),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.onCancel())}),e.EFF(8),e.k0s(),e.j41(9,"button",7),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.onConfirm())}),e.EFF(10),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.title),e.R7$(3),e.JRh(t.message),e.R7$(3),e.JRh(t.cancelText),e.R7$(2),e.JRh(t.confirmText)}}let Ke=(()=>{class i{isVisible=!1;title="Confirm";message="Are you sure?";confirmText="Confirm";cancelText="Cancel";confirmed=new e.bkB;cancelled=new e.bkB;onConfirm(){this.confirmed.emit()}onCancel(){this.cancelled.emit()}onBackdropClick(){this.onCancel()}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-confirmation-dialog"]],inputs:{isVisible:"isVisible",title:"title",message:"message",confirmText:"confirmText",cancelText:"cancelText"},outputs:{confirmed:"confirmed",cancelled:"cancelled"},decls:1,vars:1,consts:[["class","dialog-backdrop",3,"click",4,"ngIf"],[1,"dialog-backdrop",3,"click"],[1,"dialog-container",3,"click"],[3,"ngIf"],[1,"dialog-body"],[1,"dialog-footer"],["type","button",1,"cancel",3,"click"],["type","button",1,"confirm",3,"click"],[1,"dialog-header"]],template:function(o,n){1&o&&e.DNE(0,We,11,4,"div",0),2&o&&e.Y8G("ngIf",n.isVisible)},dependencies:[p.MD,p.bT],styles:[".dialog-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.dialog-container[_ngcontent-%COMP%]{background:radial-gradient(var(--content-background-left),var(--content-background-right));border-radius:8px;box-shadow:0 4px 6px #0000001a,0 2px 4px #0000000f;min-width:400px;max-width:500px;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.dialog-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--font-color-dark)}.dialog-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--font-color-dark)}.dialog-body[_ngcontent-%COMP%]{padding:1.5rem}.dialog-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--font-color-dark);line-height:1.5}.dialog-footer[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid #e5e7eb;display:flex;gap:.75rem;justify-content:center}@media (max-width: 768px){.dialog-container[_ngcontent-%COMP%]{width:90%;min-width:unset}}"]})}return i})(),Ze=(()=>{class i{notificationService;storageService;appContext;dataLoader;creatureFactory;webSocketService;db;xpService;scenarioLevel=1;scenarioId;sectionId;sessionId=1;bonusXp=0;showEndGameConfirmation=!1;endGameConfirmationMessage="";constructor(t,o,n,r,a,l,d,g){this.notificationService=t,this.storageService=o,this.appContext=n,this.dataLoader=r,this.creatureFactory=a,this.webSocketService=l,this.db=d,this.xpService=g,this.appContext.defaultLevel$.subscribe(f=>{this.scenarioLevel=f}),this.appContext.scenarioId$.subscribe(f=>{null!=f&&(this.scenarioId=f)}),this.webSocketService.sessionId$.subscribe(f=>{null!=f&&(this.sessionId=f)})}onScenarioLevelChange(t){const o=Number(t)||0;this.scenarioLevel=o,this.appContext.setDefaultLevel(o)}startNewGame(){this.appContext.setScenarioFile(null),this.storageService.resetGame()}loadScenario(){var t=this;return(0,G.A)(function*(){const o=yield t.storageService.loadFile(t.scenarioId,t.scenarioLevel).catch(r=>t.notificationService.emitErrorMessage(`Failed to load scenario: ${r.message}`));t.appContext.setScenarioFile(o??null);const n=t.storageService.parseScenarioMonsters(o,t.scenarioLevel);t.appContext.setScenarioId(t.scenarioId),n&&(n.forEach(r=>{const a={level:t.scenarioLevel,aggressive:!0,...r};t.appContext.addCreature(t.creatureFactory.createCreature(a))}),t.notificationService.emitInfoMessage(`Loaded scenario ${t.scenarioId} at level ${t.scenarioLevel}.`))})()}loadSection(){const t=this.sectionId.toString().replace("#","."),o=this.dataLoader.getData().sections.find(r=>r.index===t);if(!o||!o.rooms||0===o.rooms.length)return void this.notificationService.emitErrorMessage(`Section ${this.sectionId} contains no monsters`);const n=o.rooms.flatMap(r=>r.monster??[]).filter(r=>r);0!==n.length?(n.forEach(r=>{this.appContext.addCreature(this.creatureFactory.createCreature({type:r.name,level:this.scenarioLevel,isElite:"elite"===r?.type||"elite"===r?.player4,aggressive:!0}))}),this.notificationService.emitInfoMessage(`Loaded section ${t} at level ${this.scenarioLevel}.`)):this.notificationService.emitErrorMessage(`${this.sectionId} has no monsters for mission ${this.scenarioId}`)}startSession(){this.webSocketService.connect(M.im.Host)}joinSession(){this.webSocketService.connect(M.im.Client,this.sessionId)}endGame(){var t=this;return(0,G.A)(function*(){const o=yield t.db.getScenarioReference(t.scenarioLevel),n=Number(o?.bonus_experience??0)+Number(t.bonusXp??0);t.endGameConfirmationMessage=`Award ${n} bonus XP to all characters?`,t.showEndGameConfirmation=!0})()}onEndGameConfirmed(){var t=this;return(0,G.A)(function*(){t.showEndGameConfirmation=!1;const o=yield t.db.getScenarioReference(t.scenarioLevel),n=Number(o?.bonus_experience??0)+Number(t.bonusXp??0),r=t.appContext.getCreatures().filter(a=>!a.aggressive);for(const a of r){const l=t.appContext.findCreature(a.id),d=(l.totalXp??0)+n,g=t.xpService.levelFromXp(d);t.appContext.updateCreatureBaseStat(l.id,"totalXp",d,!0),t.appContext.updateCreatureBaseStat(l.id,"level",g,!0),t.appContext.updateCreatureBaseStat(l.id,"sessionExperience",(l.sessionExperience??0)+n,!0);try{yield t.db.updateCharacterProgress(l.type,g,d)}catch{t.notificationService.emitErrorMessage(`Failed to persist XP for ${l.type}`)}}})()}onEndGameCancelled(){this.showEndGameConfirmation=!1}static \u0275fac=function(o){return new(o||i)(e.rXU(P.J),e.rXU(Y.s),e.rXU(C.B),e.rXU(I.X),e.rXU($.Z),e.rXU(M.Vh),e.rXU(E.a),e.rXU(D))};static \u0275cmp=e.VBU({type:i,selectors:[["app-setup"]],decls:44,vars:14,consts:[[3,"toggle","expanded","ngClass"],[1,"setup-container","row","content"],[1,"section"],[1,"label-group"],["for","scenario-level"],["type","tel","placeholder","#",3,"ngModelChange","ngModel"],[1,"action-button",3,"click"],["for","scenario-id"],["for","section-id"],["type","tel","placeholder","1",3,"ngModelChange","ngModel"],["for","bonus-xp"],[3,"confirmed","cancelled","isVisible","title","message","confirmText","cancelText"]],template:function(o,n){1&o&&(e.j41(0,"app-chevron-toggle",0),e.bIt("toggle",function(){return n.appContext.shouldShowSetup=!n.appContext.shouldShowSetup}),e.k0s(),e.j41(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),e.EFF(5,"Level"),e.k0s(),e.j41(6,"input",5),e.mxI("ngModelChange",function(a){return e.DH7(n.scenarioLevel,a)||(n.scenarioLevel=a),a}),e.bIt("ngModelChange",function(a){return n.onScenarioLevelChange(a)}),e.k0s()(),e.j41(7,"button",6),e.bIt("click",function(){return n.startNewGame()}),e.EFF(8,"New"),e.k0s()(),e.j41(9,"div",2)(10,"div",3)(11,"label",7),e.EFF(12,"Mission"),e.k0s(),e.j41(13,"input",5),e.mxI("ngModelChange",function(a){return e.DH7(n.scenarioId,a)||(n.scenarioId=a),a}),e.k0s()(),e.j41(14,"button",6),e.bIt("click",function(){return n.loadScenario()}),e.EFF(15,"Load"),e.k0s()(),e.j41(16,"div",2)(17,"div",3)(18,"label",8),e.EFF(19,"Section"),e.k0s(),e.j41(20,"input",5),e.mxI("ngModelChange",function(a){return e.DH7(n.sectionId,a)||(n.sectionId=a),a}),e.k0s()(),e.j41(21,"button",6),e.bIt("click",function(){return n.loadSection()}),e.EFF(22,"Load"),e.k0s()(),e.j41(23,"div",2)(24,"button",6),e.bIt("click",function(){return n.appContext.addMonsterToggled=!n.appContext.addMonsterToggled}),e.EFF(25," Add Monster"),e.k0s()(),e.j41(26,"div",2)(27,"button",6),e.bIt("click",function(){return n.startSession()}),e.EFF(28," Host"),e.k0s()(),e.j41(29,"div",2)(30,"div",3)(31,"label",7),e.EFF(32,"ID"),e.k0s(),e.j41(33,"input",9),e.mxI("ngModelChange",function(a){return e.DH7(n.sessionId,a)||(n.sessionId=a),a}),e.k0s()(),e.j41(34,"button",6),e.bIt("click",function(){return n.joinSession()}),e.EFF(35,"Join"),e.k0s()(),e.j41(36,"div",2)(37,"div",3)(38,"label",10),e.EFF(39,"Bonus XP"),e.k0s(),e.j41(40,"input",5),e.mxI("ngModelChange",function(a){return e.DH7(n.bonusXp,a)||(n.bonusXp=a),a}),e.k0s()(),e.j41(41,"button",6),e.bIt("click",function(){return n.endGame()}),e.EFF(42,"End"),e.k0s()()(),e.j41(43,"app-confirmation-dialog",11),e.bIt("confirmed",function(){return n.onEndGameConfirmed()})("cancelled",function(){return n.onEndGameCancelled()}),e.k0s()),2&o&&(e.Y8G("expanded",n.appContext.shouldShowSetup)("ngClass",n.appContext.shouldShowSetup?"expanded":""),e.R7$(),e.xc7("display",n.appContext.shouldShowSetup?null:"none"),e.R7$(5),e.R50("ngModel",n.scenarioLevel),e.R7$(7),e.R50("ngModel",n.scenarioId),e.R7$(7),e.R50("ngModel",n.sectionId),e.R7$(13),e.R50("ngModel",n.sessionId),e.R7$(7),e.R50("ngModel",n.bonusXp),e.R7$(3),e.Y8G("isVisible",n.showEndGameConfirmation)("title","")("message",n.endGameConfirmationMessage)("confirmText","Commit")("cancelText","Cancel"))},dependencies:[p.MD,p.YU,_.YN,_.me,_.BC,_.vS,v.S,Ke,y],styles:["[_nghost-%COMP%]{position:relative}.setup-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;align-items:center;background-color:var(--content-background-left);padding:10px 0 10px 5px}.setup-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding-left:1rem;border-left:5px solid;gap:.5rem;flex:1 1 0px}.setup-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .label-group[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.setup-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .label-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding:0;font-size:20px}.setup-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .label-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:60px}.setup-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none}@media (max-width: 768px){.setup-container[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.chevron[_ngcontent-%COMP%]{position:absolute;display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;cursor:pointer;transition:transform .2s ease,color .2s ease;outline:none;top:10px;right:10px;color:var(--font-color-dark);border-radius:4px;padding:4px}.chevron.expanded[_ngcontent-%COMP%]{transform:rotate(180deg);top:0}.chevron[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}app-chevron-toggle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;--font-color: var(--font-color-dark)}app-chevron-toggle.expanded[_ngcontent-%COMP%]{top:0}"]})}return i})();var qe=m(5964),et=m(3669),V=m(9974),tt=m(4360);function U(i,c=et.D){return i=i??nt,(0,V.N)((t,o)=>{let n,r=!0;t.subscribe((0,tt._)(o,a=>{const l=c(a);(r||!i(n,l))&&(r=!1,n=l,o.next(a))}))})}function nt(i,c){return i===c}var ot=m(8141),it=m(1985);function ct(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",3)(1,"h3",4),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.shouldExpand=!n.shouldExpand)}),e.EFF(2,"Monster References"),e.k0s(),e.j41(3,"app-chevron-toggle",5),e.bIt("toggle",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.shouldExpand=!n.shouldExpand)}),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(3),e.Y8G("expanded",t.shouldExpand)}}function st(i,c){1&i&&(e.j41(0,"span",30),e.nrm(1,"span",31),e.k0s()),2&i&&e.Y8G("ngClass",c.$implicit)}function lt(i,c){if(1&i&&(e.qex(0),e.j41(1,"span",17),e.DNE(2,st,2,1,"span",29),e.k0s(),e.bVm()),2&i){const t=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",t.immunities)}}function dt(i,c){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td",11)(2,"div",12)(3,"img",13),e.bIt("error",function(){const n=s.eBV(t).$implicit,r=e.XpG(3);return s.Njj(r.onImgError(n.type))}),e.k0s(),e.j41(4,"span",14),e.EFF(5),e.k0s()()(),e.j41(6,"td",15),e.nrm(7,"span",16),e.j41(8,"span",17),e.EFF(9),e.k0s()(),e.j41(10,"td",18),e.nrm(11,"span",19),e.j41(12,"span",17),e.EFF(13),e.k0s()(),e.j41(14,"td",20),e.nrm(15,"span",21),e.j41(16,"span",17),e.EFF(17),e.k0s()(),e.j41(18,"td",22),e.nrm(19,"span",23),e.j41(20,"span",17),e.EFF(21),e.k0s()(),e.j41(22,"td",24),e.nrm(23,"span",25),e.j41(24,"span",17),e.EFF(25),e.k0s()(),e.j41(26,"td",26)(27,"span",17),e.EFF(28),e.k0s()(),e.j41(29,"td",27),e.DNE(30,lt,3,1,"ng-container",28),e.k0s()()}if(2&i){const t=c.$implicit,o=e.XpG(3);e.R7$(3),e.Y8G("src",o.getCreaturePic(t.type),e.B4B),e.R7$(2),e.JRh(t.type),e.R7$(4),e.Lme("",t.eliteHp," | ",t.normalHp),e.R7$(4),e.SjE("",null!=t.attackProfile&&t.attackProfile.isPrimarilyRanged?"( R )":"( M )"," [M",t.attackProfile.meleeAttackCount,", R",t.attackProfile.rangedAttackCount,"] ",t.eliteAtk," | ",t.normalAtk),e.R7$(4),e.Lme("",t.eliteArmor," | ",t.normalArmor),e.R7$(4),e.Lme("",t.eliteRetaliate," | ",t.normalRetaliate),e.R7$(4),e.Lme("",t.eliteMovement," | ",t.normalMovement),e.R7$(3),e.E5c(" # ",t.minInitiative," | ",t.avgInitiative," | ",t.maxInitiative," "),e.R7$(2),e.Y8G("ngIf",null==t.immunities?null:t.immunities.length)}}function pt(i,c){if(1&i&&(e.j41(0,"div",8)(1,"table",9)(2,"tbody"),e.DNE(3,dt,31,19,"tr",10),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(3),e.Y8G("ngForOf",t.monsterRows)}}function ut(i,c){if(1&i&&(e.j41(0,"div")(1,"div",6),e.DNE(2,pt,4,1,"div",7),e.k0s()()),2&i){const t=e.XpG();e.xc7("display",t.shouldExpand?null:"none"),e.R7$(2),e.Y8G("ngIf",null==t.monsterRows?null:t.monsterRows.length)}}let gt=(()=>{class i{dataLoader;creatureFactory;appContext=(0,s.WQX)(C.B);monsterList=[];shouldExpand=!0;vm$=(0,F.z)([this.appContext.scenarioId$,this.appContext.defaultLevel$]).pipe((0,k.T)(([t,o])=>({scenarioId:t,level:o,ready:null!=t&&null!=o})));buildTrigger$=(0,F.z)([this.appContext.scenarioId$,this.appContext.defaultLevel$]).pipe((0,qe.p)(([t,o])=>null!=t&&null!=o),U(([t,o],[n,r])=>t===n&&o===r),(0,ot.M)(([t,o])=>this.buildMonsterList(t,o)));constructor(t,o){this.dataLoader=t,this.creatureFactory=o,this.buildTrigger$.pipe(function H(i){i||(i=(0,s.WQX)(s.abz));const c=new it.c(t=>{if(!i.destroyed)return i.onDestroy(t.next.bind(t));t.next()});return t=>t.pipe((0,b.Q)(c))}()).subscribe()}buildMonsterList(t,o){this.monsterList=[];const n=this.getAllScenarioMonsters(t);for(const r of n)this.monsterList.push(this.creatureFactory.createCreature({level:o,aggressive:!0,isElite:!1,type:r}),this.creatureFactory.createCreature({level:o,aggressive:!0,isElite:!0,type:r}));this.monsterList.sort((r,a)=>r.type.localeCompare(a.type))}get monsterRows(){const t=new Map;for(const n of this.monsterList){const r=this.analyzeRangedProfile(n),a=t.get(n.type)??{type:n.type,attackProfile:r,normalAtk:0,eliteAtk:0,normalArmor:0,eliteArmor:0,normalHp:0,eliteHp:0,normalMovement:0,eliteMovement:0,normalRetaliate:0,eliteRetaliate:0,immunities:[],abilityCards:[]};n.isElite?(a.eliteAtk=n.attack,a.eliteArmor=n.armor,a.eliteHp=n.hp,a.eliteMovement=n.movement,a.eliteRetaliate=n.retaliate):(a.normalAtk=n.attack,a.normalArmor=n.armor,a.normalHp=n.hp,a.normalMovement=n.movement,a.normalRetaliate=n.retaliate);{const l=new Set(a.immunities);for(const d of n.immunities??[]){const g=(d??"").trim();g&&l.add(g)}a.immunities=[...l]}{const l=new Set((a.abilityCards??[]).map(d=>d?.cardId).filter(d=>"number"==typeof d));for(const d of n.abilityCards??[]){const g=d?.cardId;"number"==typeof g?l.has(g)||(a.abilityCards.push(d),l.add(g)):a.abilityCards.push(d)}}t.set(n.type,a)}const o=[...t.values()];for(const n of o)n.immunities.sort((r,a)=>r.localeCompare(a));for(const n of o){const r=n.abilityCards??[];if(!r.length){n.minInitiative=void 0,n.maxInitiative=void 0,n.avgInitiative=void 0;continue}let a=1/0,l=-1/0,d=0,g=0;for(const f of r){const h=f?.initiative;"number"==typeof h&&(a=Math.min(a,h),l=Math.max(l,h),d+=h,g++)}g>0?(n.minInitiative=a,n.maxInitiative=l,n.avgInitiative=Math.round(d/g)):(n.minInitiative=void 0,n.maxInitiative=void 0,n.avgInitiative=void 0)}return o}getAllScenarioMonsters(t){const o=this.dataLoader.getData().scenarios?.filter(r=>r.index===t).flatMap(r=>r.monsters??[])??[],n=this.dataLoader.getData().sections?.filter(r=>r.parent===t).flatMap(r=>r.monsters??[])??[];return Array.from(new Set([...o,...n].map(r=>(r??"").trim()).filter(Boolean)))}isRangedAttackAction(t){const o=[...t?.subActions??[]];for(;o.length;){const n=o.pop();if(!n)continue;if("range"===n.type)return!0;const r=n.subActions;Array.isArray(r)&&r.length&&o.push(...r)}return!1}analyzeRangedProfile(t){const o=t.abilityCards??[];let n=0,r=0;for(const f of o){const h=f?.actions??[];for(const O of h)"attack"===O?.type&&(n++,this.isRangedAttackAction(O)&&r++)}const a=n-r,l=r>a,d=t.type||t.name||"unknown";return{monsterType:d,attackCount:n,rangedAttackCount:r,meleeAttackCount:a,isPrimarilyRanged:l,description:0===n?`${d}: no attack actions found in ability cards.`:l?`${d}: primarily ranged (${r}/${n} attacks have range).`:`${d}: primarily melee/close (${a}/${n} attacks do not have range).`}}failedPics=new Set;getCreaturePic(t){return this.failedPics.has(t)?"./images/bb/daemon-skull.svg":`./images/monster/thumbnail/fh-${t}.png`}onImgError(t){this.failedPics.add(t)}static \u0275fac=function(o){return new(o||i)(e.rXU(I.X),e.rXU($.Z))};static \u0275cmp=e.VBU({type:i,selectors:[["app-scenario-monster-reference"]],decls:4,vars:4,consts:[[1,"scenario-monster-reference-container"],["class","title-row",4,"ngIf"],[3,"display",4,"ngIf"],[1,"title-row"],["role","button","tabindex","0",3,"click"],[3,"toggle","expanded"],[1,"monster-ref"],["class","monster-reference-table",4,"ngIf"],[1,"monster-reference-table"],[1,"ref-table"],[4,"ngFor","ngForOf"],[1,"name-cell"],[1,"name-wrap"],[1,"monster-icon",3,"error","src"],[1,"name"],[1,"stat","hp"],[1,"icon","heart"],[1,"val"],[1,"stat","attack"],[1,"icon","attack"],[1,"stat","armor"],[1,"icon","shield"],[1,"stat","retaliate"],[1,"icon","retaliate"],[1,"stat","movement"],[1,"icon","move"],[1,"stat","initiative"],[1,"stat","immunities"],[4,"ngIf"],["class","icon imm",3,"ngClass",4,"ngFor","ngForOf"],[1,"icon","imm",3,"ngClass"],[1,"icon","immune"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.DNE(1,ct,4,1,"div",1)(2,ut,3,3,"div",2),e.nI1(3,"async"),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngIf",null==n.monsterRows?null:n.monsterRows.length),e.R7$(),e.Y8G("ngIf",e.bMT(3,2,n.vm$)))},dependencies:[p.MD,p.YU,p.Sq,p.bT,y,p.Jj],styles:[".title-row[_ngcontent-%COMP%]{display:inline-flex;gap:8px}.title-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;-webkit-user-select:none;user-select:none;cursor:pointer;transition:opacity .2s ease}.title-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:hover{opacity:.8}.monster-reference-table[_ngcontent-%COMP%]{width:100%}.ref-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border:1px solid rgba(255,255,255,.35)}.ref-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.25);overflow:hidden;text-overflow:ellipsis}.ref-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.ref-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd)   td[_ngcontent-%COMP%]{background:#ffffff05}.profile[_ngcontent-%COMP%]{width:70px;height:70px}.name-cell[_ngcontent-%COMP%]{text-align:left}.name-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.monster-icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;object-fit:cover;flex-shrink:0}.name[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px;white-space:normal}.icon.imm[_ngcontent-%COMP%]{position:relative;opacity:.7}.icon.imm[_ngcontent-%COMP%]   .icon.immune[_ngcontent-%COMP%]{position:absolute;bottom:0;right:-10px;width:15px;height:15px;opacity:1;filter:none;pointer-events:none}.stat[_ngcontent-%COMP%]{width:auto;text-align:left;white-space:nowrap;font-weight:700}.stat[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:inline-block;width:30px;height:30px;margin-right:6px;vertical-align:-3px;background-repeat:no-repeat;background-position:center;background-size:contain}@media (max-width: 768px){.ref-table[_ngcontent-%COMP%]{table-layout:fixed}.ref-table[_ngcontent-%COMP%], .ref-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%], .ref-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%], .ref-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:block;width:100%}.ref-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.25);padding:10px 12px}.ref-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:none;padding:6px 0}.ref-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#ffffff05}.name[_ngcontent-%COMP%]{white-space:normal}.monster-icon[_ngcontent-%COMP%]{width:36px;height:36px}.name-wrap[_ngcontent-%COMP%]{gap:10px}.stat[_ngcontent-%COMP%]{width:auto;white-space:normal;text-align:left;display:flex;align-items:center;gap:8px}.stat[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:0;vertical-align:0;padding-right:1rem}}"]})}return i})();var mt=m(8359);function _t(i,c){1&i&&e.nrm(0,"span",4)}function ft(i,c){if(1&i&&(e.j41(0,"span",5),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI("#",t.sessionId)}}let Ct=(()=>{class i{wsService;status=M.vk.Disconnected;sessionId=null;sub;labels={[M.vk.Connected]:"Connected",[M.vk.Connecting]:"Connecting",[M.vk.Reconnecting]:"Reconnecting",[M.vk.Disconnected]:"Offline",[M.vk.Failed]:"Connection lost"};get label(){return this.labels[this.status]??"Unknown"}constructor(t){this.wsService=t}ngOnInit(){this.sub=new mt.yU,this.sub.add(this.wsService.connectionStatus$.subscribe(t=>this.status=t)),this.sub.add(this.wsService.sessionId$.subscribe(t=>this.sessionId=t))}ngOnDestroy(){this.sub?.unsubscribe()}static \u0275fac=function(o){return new(o||i)(e.rXU(M.Vh))};static \u0275cmp=e.VBU({type:i,selectors:[["app-connection-status"]],decls:6,vars:5,consts:[[1,"status-pill",3,"ngClass"],[1,"dot"],["class","pulse",4,"ngIf"],["class","session-id",4,"ngIf"],[1,"pulse"],[1,"session-id"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"span",1),e.DNE(2,_t,1,0,"span",2),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s(),e.DNE(5,ft,2,1,"span",3),e.k0s()),2&o&&(e.Y8G("ngClass","status-"+n.status),e.BMQ("aria-label",n.label),e.R7$(2),e.Y8G("ngIf","connecting"===n.status||"reconnecting"===n.status),e.R7$(2),e.JRh(n.label),e.R7$(),e.Y8G("ngIf","connected"===n.status&&null!=n.sessionId))},dependencies:[p.MD,p.YU,p.bT],styles:["[_nghost-%COMP%]{display:inline-block}.status-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 10px 4px 7px;border-radius:999px;border:1px solid transparent;font-family:DM Mono,Courier New,monospace;font-size:11px;font-weight:500;letter-spacing:.04em;text-transform:uppercase;white-space:nowrap;-webkit-user-select:none;user-select:none;transition:background .4s ease,border-color .4s ease,color .4s ease}.dot[_ngcontent-%COMP%]{position:relative;width:8px;height:8px;border-radius:50%;flex-shrink:0}.pulse[_ngcontent-%COMP%]{position:absolute;inset:-3px;border-radius:50%;animation:_ngcontent-%COMP%_pulse 1.4s ease-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:.7;transform:scale(1)}to{opacity:0;transform:scale(2.4)}}.status-connected[_ngcontent-%COMP%]{background:#22c55e1f;border-color:#22c55e4d;color:#16a34a}.status-connected[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{background:#22c55e}.status-connecting[_ngcontent-%COMP%]{background:#eab3081a;border-color:#eab3084d;color:#a16207}.status-connecting[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{background:#eab308}.status-connecting[_ngcontent-%COMP%]   .pulse[_ngcontent-%COMP%]{background:#eab30880}.status-reconnecting[_ngcontent-%COMP%]{background:#f973161a;border-color:#f973164d;color:#c2410c}.status-reconnecting[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{background:#f97316}.status-reconnecting[_ngcontent-%COMP%]   .pulse[_ngcontent-%COMP%]{background:#f9731680}.status-disconnected[_ngcontent-%COMP%]{background:#94a3b81a;border-color:#94a3b840;color:#64748b}.status-disconnected[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{background:#94a3b8}.status-failed[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef44444d;color:#dc2626}.status-failed[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{background:#ef4444}@media (prefers-color-scheme: dark){.status-connected[_ngcontent-%COMP%]{background:#22c55e26;color:#5f7d4b}.status-connecting[_ngcontent-%COMP%]{background:#eab30826;color:#facc15}.status-reconnecting[_ngcontent-%COMP%]{background:#f9731626;color:#fb923c}.status-disconnected[_ngcontent-%COMP%]{background:#94a3b81a;color:#94a3b8}.status-failed[_ngcontent-%COMP%]{background:#ef444426;color:#f87171}}.session-id[_ngcontent-%COMP%]{margin-left:2px}"]})}return i})();var ht=m(7705);function bt(i,c){if(1&i&&(e.j41(0,"tr")(1,"td"),e.nrm(2,"span",9),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s()()),2&i){const t=c.$implicit;e.R7$(2),e.Y8G("ngClass",t.key),e.R7$(2),e.JRh(t.value)}}function vt(i,c){if(1&i&&(e.j41(0,"div",6)(1,"table",7)(2,"tbody"),e.DNE(3,bt,5,2,"tr",8),e.k0s()()()),2&i){const t=e.XpG(2);e.xc7("display",t.shouldExpand?null:"none"),e.R7$(3),e.Y8G("ngForOf",t.sortedLoot)("ngForTrackBy",t.trackByKey)}}function Mt(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h3",3),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.shouldExpand=!n.shouldExpand)}),e.EFF(3,"Loot Deck"),e.k0s(),e.j41(4,"app-chevron-toggle",4),e.bIt("toggle",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.shouldExpand=!n.shouldExpand)}),e.k0s()(),e.DNE(5,vt,4,4,"div",5),e.k0s()}if(2&i){const t=e.XpG();e.R7$(4),e.Y8G("expanded",t.shouldExpand),e.R7$(),e.Y8G("ngIf",null==t.scenario?null:t.scenario.lootDeckConfig)}}let xt=(()=>{class i{appContext;cd;scenarioFile;scenario=null;shouldExpand=!0;destroy$=new x.B;constructor(t,o){this.appContext=t,this.cd=o}ngOnInit(){this.scenarioFile&&(this.scenario=this.scenarioFile,this.cd.markForCheck()),this.appContext.scenarioFile$.pipe((0,b.Q)(this.destroy$)).subscribe(t=>{t&&(this.scenario=t,this.cd.markForCheck())})}trackByKey(t){return t.key}get sortedLoot(){const t=this.scenario?.lootDeckConfig;if(!t)return[];const o=["money","metal","lumber","hide"],n=Object.entries(t).map(([r,a])=>({key:r,value:a}));return n.sort((r,a)=>{const l=o.indexOf(r.key),d=o.indexOf(a.key);return-1!==l||-1!==d?-1===l?1:-1===d?-1:l-d:"random_item"===r.key?1:"random_item"===a.key?-1:r.key.localeCompare(a.key)}),n}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B),e.rXU(ht.gRc))};static \u0275cmp=e.VBU({type:i,selectors:[["app-loot"]],inputs:{scenarioFile:"scenarioFile"},decls:1,vars:1,consts:[["class","loot-container",4,"ngIf"],[1,"loot-container"],[1,"title-row"],["role","button","tabindex","0",3,"click"],[3,"toggle","expanded"],["class","loot-deck-config",3,"display",4,"ngIf"],[1,"loot-deck-config"],[1,"legend-table"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"icon",3,"ngClass"]],template:function(o,n){1&o&&e.DNE(0,Mt,6,2,"div",0),2&o&&e.Y8G("ngIf",n.scenario)},dependencies:[p.MD,p.YU,p.Sq,p.bT,y],styles:[".icon[_ngcontent-%COMP%]{width:35px;height:35px;background-repeat:no-repeat;background-size:contain;background-position:center}.icon.shield[_ngcontent-%COMP%]{background-image:url(shield.5d790066de2a838f.svg)}.icon.retaliate[_ngcontent-%COMP%]{background-image:url(retaliate.96317f6bfaf21f94.svg)}.icon.attack[_ngcontent-%COMP%]{background-image:url(attack.eab16c193b4557a8.svg)}.icon.move[_ngcontent-%COMP%]{background-image:url(move.229fb089ff8f3d0a.svg)}.icon.poison[_ngcontent-%COMP%]{background-image:url(poison.360385033a29e942.svg)}.icon.wound[_ngcontent-%COMP%]{background-image:url(wound.f8889de5d3c71959.svg)}.icon.brittle[_ngcontent-%COMP%]{background-image:url(brittle.252f29ead62d70bf.svg)}.icon.ward[_ngcontent-%COMP%]{background-image:url(ward.993181d6a50f02ba.svg)}.icon.immobilize[_ngcontent-%COMP%]{background-image:url(immobilize.1e5803f1bc346d84.svg)}.icon.bane[_ngcontent-%COMP%]{background-image:url(bane.a7d99de969d69e66.svg)}.icon.muddle[_ngcontent-%COMP%]{background-image:url(muddle.b7b817f40efc791f.svg)}.icon.stun[_ngcontent-%COMP%]{background-image:url(stun.ca58739fb52a5b39.svg)}.icon.impair[_ngcontent-%COMP%]{background-image:url(impair.34d630196818b373.svg)}.icon.disarm[_ngcontent-%COMP%]{background-image:url(disarm.b718a1baf045a69e.svg)}.icon.regenerate[_ngcontent-%COMP%]{background-image:url(regenerate.a5c97902ad3c1c64.svg)}.icon.invisible[_ngcontent-%COMP%]{background-image:url(invisible.063c0ca4b394eadc.svg)}.icon.strengthen[_ngcontent-%COMP%]{background-image:url(strengthen.2f3225d7ac54ae1d.svg)}.icon.damage[_ngcontent-%COMP%]{background-image:url(damage.f7173948a7b5304f.svg)}.icon.pierce[_ngcontent-%COMP%]{background-image:url(pierce.c78a0befb22b4834.svg)}.icon.heart[_ngcontent-%COMP%]{background-image:url(heart.6e6ebd4d7b276aea.svg)}.icon.flying[_ngcontent-%COMP%]{background-image:url(fly.3c6e1e1a47b7ad0e.svg)}.icon.target[_ngcontent-%COMP%]{background-image:url(target.08dfab83467e9a84.svg)}.icon.undo[_ngcontent-%COMP%]{background-image:url(undo.b8040817bea1b7d8.svg)}.icon.range[_ngcontent-%COMP%]{background-image:url(range.d1e7e348f4a4f4a6.svg)}.icon.immune[_ngcontent-%COMP%]{background-image:url(immune.3638b2264dfc0cf4.svg)}.icon.target[_ngcontent-%COMP%]{background-image:url(target.08dfab83467e9a84.svg)}.icon.snowthistle[_ngcontent-%COMP%]{background-image:url(snowthistle.43b0e5047cb62399.svg)}.icon.axenut[_ngcontent-%COMP%]{background-image:url(axenut.5f58b7860ae7c1b9.svg)}.icon.arrowvine[_ngcontent-%COMP%]{background-image:url(arrowvine.eb2b90e2c1e8a8d0.svg)}.icon.rockroot[_ngcontent-%COMP%]{background-image:url(rockroot.e280bddf8428a20e.svg)}.icon.corpsecap[_ngcontent-%COMP%]{background-image:url(corpsecap.76d6d06ba1a31f21.svg)}.icon.flamefruit[_ngcontent-%COMP%]{background-image:url(flamefruit.9a678b089c89ce00.svg)}.icon.metal[_ngcontent-%COMP%]{background-image:url(metal.e4a07f2515c5a1ab.svg)}.icon.lumber[_ngcontent-%COMP%]{background-image:url(lumber.5b84d843acf0ada0.svg)}.icon.hide[_ngcontent-%COMP%]{background-image:url(hide.64a78844c7492445.svg)}.icon.gold[_ngcontent-%COMP%]{background-image:url(money.13b3b06569dbae3c.svg)}.icon.money[_ngcontent-%COMP%]{background-image:url(money.13b3b06569dbae3c.svg)}.icon.random_item[_ngcontent-%COMP%]{background-image:url(random_item.c413e3e402425681.svg)}.icon.xp[_ngcontent-%COMP%]{background-image:url(experience.4bdb59a388110fca.svg)}.icon.level[_ngcontent-%COMP%]{background-image:url(level.24629cf5e7158291.svg)}[_nghost-%COMP%]{display:block}.loot-container[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]{display:inline-flex;gap:8px}.loot-container[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;-webkit-user-select:none;user-select:none;cursor:pointer;transition:opacity .2s ease}.loot-container[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:hover{opacity:.8}.loot-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border:1px solid rgba(255,255,255,.35)}.loot-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.25);color:var(--font-color);font-weight:700}.loot-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.loot-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd)   td[_ngcontent-%COMP%]{background:#ffffff05}.loot-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{text-align:left;font-weight:700;letter-spacing:.2px;display:flex;align-items:center;justify-content:flex-start;gap:12px}.loot-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{text-align:right;white-space:nowrap;width:140px}.loot-container[_ngcontent-%COMP%]   .loot-deck-config[_ngcontent-%COMP%]{display:block}.loot-container[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{flex-shrink:0;filter:brightness(0) saturate(100%) invert(97%) sepia(15%) saturate(500%) hue-rotate(5deg) brightness(103%) contrast(97%);opacity:var(--font-color-opacity, 1)}"],changeDetection:0})}return i})();var Ot=m(5558),Pt=m(6648);const z={now:()=>(z.delegate||Date).now(),delegate:void 0};class kt extends x.B{constructor(c=1/0,t=1/0,o=z){super(),this._bufferSize=c,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,c),this._windowTime=Math.max(1,t)}next(c){const{isStopped:t,_buffer:o,_infiniteTimeWindow:n,_timestampProvider:r,_windowTime:a}=this;t||(o.push(c),!n&&o.push(r.now()+a)),this._trimBuffer(),super.next(c)}_subscribe(c){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(c),{_infiniteTimeWindow:o,_buffer:n}=this,r=n.slice();for(let a=0;a<r.length&&!c.closed;a+=o?1:2)c.next(r[a]);return this._checkFinalizedStatuses(c),t}_trimBuffer(){const{_bufferSize:c,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:n}=this,r=(n?1:2)*c;if(c<1/0&&r<o.length&&o.splice(0,o.length-r),!n){const a=t.now();let l=0;for(let d=1;d<o.length&&o[d]<=a;d+=2)l=d;l&&o.splice(0,l+1)}}}var J=m(8750),Q=m(7707);function B(i,c,...t){if(!0===c)return void i();if(!1===c)return;const o=new Q.Ms({next:()=>{o.unsubscribe(),i()}});return(0,J.Tg)(c(...t)).subscribe(o)}const wt=i=>["Bonus Experience",i],It=i=>["Gold Multiplier",i],Rt=i=>["Trap Damage",i],Ft=i=>["Hazardous Damage",i],St=i=>["Monster Level",i],Tt=(i,c,t,o,n)=>[i,c,t,o,n],Et=(i,c)=>c[0];function $t(i,c){if(1&i&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s()()),2&i){const t=c.$implicit;e.R7$(2),e.JRh(t[0]),e.R7$(2),e.JRh(t[1])}}function Gt(i,c){if(1&i&&(e.j41(0,"tbody"),e.Z7z(1,$t,5,2,"tr",null,Et),e.k0s()),2&i){const t=c;e.R7$(),e.Dyx(e.s1E(10,Tt,e.eq3(0,wt,t.bonus_experience),e.eq3(2,It,t.gold_conversion),e.eq3(4,Rt,t.trap_damage),e.eq3(6,Ft,t.hazardous_terrain),e.eq3(8,St,t.monster_level)))}}function Bt(i,c){if(1&i&&(e.j41(0,"table",5),e.nVh(1,Gt,3,16,"tbody"),e.k0s()),2&i){let t;const o=e.XpG();e.xc7("display",o.shouldExpand?null:"none"),e.R7$(),e.vxM((t=c.ref)?1:-1,t)}}let Xt=(()=>{class i{appContext=(0,s.WQX)(C.B);db=(0,s.WQX)(E.a);shouldExpand=!0;vm$=this.appContext.defaultLevel$.pipe(U(),(0,Ot.n)(t=>(0,Pt.H)(this.db.getScenarioReference(t)).pipe((0,k.T)(o=>({level:t,ref:(Array.isArray(o)?o[0]:o)??null})))),function jt(i,c,t){let o,n=!1;return i&&"object"==typeof i?({bufferSize:o=1/0,windowTime:c=1/0,refCount:n=!1,scheduler:t}=i):o=i??1/0,function yt(i={}){const{connector:c=()=>new x.B,resetOnError:t=!0,resetOnComplete:o=!0,resetOnRefCountZero:n=!0}=i;return r=>{let a,l,d,g=0,f=!1,h=!1;const O=()=>{l?.unsubscribe(),l=void 0},X=()=>{O(),a=d=void 0,f=h=!1},Wt=()=>{const j=a;X(),j?.unsubscribe()};return(0,V.N)((j,W)=>{g++,!h&&!f&&O();const S=d=d??c();W.add(()=>{g--,0===g&&!h&&!f&&(l=B(Wt,n))}),S.subscribe(W),!a&&g>0&&(a=new Q.Ms({next:T=>S.next(T),error:T=>{h=!0,O(),l=B(X,t,T),S.error(T)},complete:()=>{f=!0,O(),l=B(X,o),S.complete()}}),(0,J.Tg)(j).subscribe(a))})(r)}}({connector:()=>new kt(o,c,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:n})}({bufferSize:1,refCount:!0}));static \u0275fac=function(o){return new(o||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-scenario-general-reference"]],decls:7,vars:4,consts:[[1,"legend-container"],[1,"title-row"],["role","button","tabindex","0",3,"click"],[3,"toggle","expanded"],[1,"legend-table",3,"display"],[1,"legend-table"]],template:function(o,n){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h3",2),e.bIt("click",function(){return n.shouldExpand=!n.shouldExpand}),e.EFF(3,"Scenario References"),e.k0s(),e.j41(4,"app-chevron-toggle",3),e.bIt("toggle",function(){return n.shouldExpand=!n.shouldExpand}),e.k0s()(),e.nVh(5,Bt,2,3,"table",4),e.nI1(6,"async"),e.k0s()),2&o){let r;e.R7$(4),e.Y8G("expanded",n.shouldExpand),e.R7$(),e.vxM((r=e.bMT(6,2,n.vm$))?5:-1,r)}},dependencies:[p.MD,y,p.Jj],styles:[".legend-container[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]{display:inline-flex;gap:8px}.legend-container[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;-webkit-user-select:none;user-select:none;cursor:pointer;transition:opacity .2s ease}.legend-container[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:hover{opacity:.8}.legend-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border:1px solid rgba(255,255,255,.35)}.legend-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.25);color:var(--font-color);font-weight:700}.legend-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.legend-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd)   td[_ngcontent-%COMP%]{background:#ffffff05}.legend-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{text-align:left;font-weight:700;letter-spacing:.2px}.legend-container[_ngcontent-%COMP%]   .legend-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{text-align:right;white-space:nowrap;width:140px}"]})}return i})();function Dt(i,c){if(1&i&&(e.j41(0,"span",5),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.JRh(t.pendingInitiative)}}function Nt(i,c){if(1&i){const t=e.RV6();e.j41(0,"button",13),e.bIt("click",function(){const n=s.eBV(t).$implicit,r=e.XpG(3);return s.Njj(r.selectCharacter(n.type))}),e.j41(1,"img",14),e.bIt("error",function(n){return s.eBV(t),s.Njj(n.target.src="./images/bb/daemon-skull.svg")}),e.k0s(),e.j41(2,"span"),e.EFF(3),e.k0s()()}if(2&i){const t=c.$implicit;e.R7$(),e.Y8G("src","./images/character/thumbnail/fh-"+t.type+".png",e.B4B),e.R7$(2),e.JRh(t.name||t.type)}}function At(i,c){if(1&i&&(e.qex(0),e.j41(1,"p",10),e.EFF(2,"Select your character:"),e.k0s(),e.j41(3,"div",11),e.DNE(4,Nt,4,2,"button",12),e.k0s(),e.bVm()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.characters)}}function Yt(i,c){if(1&i&&(e.j41(0,"p",23),e.EFF(1," Ready: "),e.j41(2,"strong"),e.EFF(3),e.k0s(),e.j41(4,"span",24),e.EFF(5,"(changes until Next Round)"),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(3),e.JRh(t.pendingInitiative)}}function Lt(i,c){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"div",15)(2,"img",16),e.bIt("error",function(n){return s.eBV(t),s.Njj(n.target.src="./images/bb/daemon-skull.svg")}),e.k0s(),e.j41(3,"span",17),e.EFF(4),e.k0s(),e.j41(5,"button",18),e.bIt("click",function(){s.eBV(t);const n=e.XpG(2);return s.Njj(n.clearCharacterSelection())}),e.EFF(6,"\u21ba"),e.k0s()(),e.j41(7,"p",10),e.EFF(8,"Enter your initiative (secret):"),e.k0s(),e.j41(9,"div",19)(10,"input",20),e.mxI("ngModelChange",function(n){s.eBV(t);const r=e.XpG(2);return e.DH7(r.initiativeInput,n)||(r.initiativeInput=n),s.Njj(n)}),e.bIt("keyup.enter",function(){s.eBV(t);const n=e.XpG(2);return s.Njj(n.submitInitiative())}),e.k0s(),e.j41(11,"button",21),e.bIt("click",function(){s.eBV(t);const n=e.XpG(2);return s.Njj(n.submitInitiative())}),e.EFF(12,"Submit"),e.k0s()(),e.DNE(13,Yt,6,1,"p",22),e.bVm()}if(2&i){const t=e.XpG(2);e.R7$(2),e.Y8G("src","./images/character/thumbnail/fh-"+t.selectedCharacterType+".png",e.B4B),e.R7$(2),e.JRh(t.selectedCharacterName),e.R7$(6),e.R50("ngModel",t.initiativeInput),e.R7$(3),e.Y8G("ngIf",null!==t.pendingInitiative)}}function Vt(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",6)(1,"div",7)(2,"span"),e.EFF(3,"My Initiative"),e.k0s(),e.j41(4,"button",8),e.bIt("click",function(){s.eBV(t);const n=e.XpG();return s.Njj(n.close())}),e.EFF(5,"\u2715"),e.k0s()(),e.DNE(6,At,5,1,"ng-container",9)(7,Lt,14,4,"ng-container",9),e.k0s()}if(2&i){const t=e.XpG();e.R7$(6),e.Y8G("ngIf",!t.selectedCharacterType),e.R7$(),e.Y8G("ngIf",t.selectedCharacterType)}}let Ut=(()=>{class i{appContext;initiativeService;isOpen=!1;selectedCharacterType=null;pendingInitiative=null;initiativeInput="";unsubscribe$=new x.B;constructor(t,o){this.appContext=t,this.initiativeService=o}ngOnInit(){this.initiativeService.selectedCharacterType$.pipe((0,b.Q)(this.unsubscribe$)).subscribe(t=>{this.selectedCharacterType=t}),this.initiativeService.pendingInitiative$.pipe((0,b.Q)(this.unsubscribe$)).subscribe(t=>{this.pendingInitiative=t,this.initiativeInput=null!==t?String(t):""})}get characters(){return this.appContext.getCreatures().filter(t=>!t.aggressive)}get selectedCharacterName(){return this.selectedCharacterType?this.characters.find(o=>o.type===this.selectedCharacterType)?.name||this.selectedCharacterType:""}selectCharacter(t){this.initiativeService.selectCharacter(t)}submitInitiative(){const t=parseInt(this.initiativeInput,10);!isNaN(t)&&t>=0&&t<=99&&(this.initiativeService.setPendingInitiative(t),this.isOpen=!1)}clearCharacterSelection(){this.initiativeService.selectCharacter(null)}toggleOpen(){this.isOpen=!this.isOpen}close(){this.isOpen=!1}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B),e.rXU(L))};static \u0275cmp=e.VBU({type:i,selectors:[["app-initiative-bubble"]],decls:6,vars:4,consts:[[1,"initiative-bubble-wrapper"],["title","Enter your initiative",1,"bubble-btn",3,"click"],[1,"bubble-icon"],["class","bubble-badge",4,"ngIf"],["class","bubble-panel",4,"ngIf"],[1,"bubble-badge"],[1,"bubble-panel"],[1,"panel-header"],[1,"close-btn",3,"click"],[4,"ngIf"],[1,"panel-hint"],[1,"char-list"],["class","char-btn",3,"click",4,"ngFor","ngForOf"],[1,"char-btn",3,"click"],[1,"char-thumb",3,"error","src"],[1,"selected-char"],[1,"char-thumb-sm",3,"error","src"],[1,"char-name"],["title","Change character",1,"change-btn",3,"click"],[1,"initiative-row"],["type","tel","maxlength","2","placeholder","00",1,"initiative-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"submit-btn",3,"click"],["class","submitted-label",4,"ngIf"],[1,"submitted-label"],[1,"hint"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"button",1),e.bIt("click",function(){return n.toggleOpen()}),e.j41(2,"span",2),e.EFF(3,"\u2694"),e.k0s(),e.DNE(4,Dt,2,1,"span",3),e.k0s(),e.DNE(5,Vt,8,2,"div",4),e.k0s()),2&o&&(e.R7$(),e.AVh("has-pending",null!==n.pendingInitiative),e.R7$(3),e.Y8G("ngIf",null!==n.pendingInitiative),e.R7$(),e.Y8G("ngIf",n.isOpen))},dependencies:[p.MD,p.Sq,p.bT,_.YN,_.me,_.BC,_.tU,_.vS],styles:["[_nghost-%COMP%]{position:fixed;bottom:1.5rem;right:1.5rem;z-index:1000}.initiative-bubble-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:.75rem}.bubble-btn[_ngcontent-%COMP%]{position:relative;width:56px;height:56px;border-radius:50%;background:var(--primary-color);border:2px solid var(--secondary-color);color:var(--font-color);font-size:1.4rem;cursor:pointer;box-shadow:0 4px 12px #00000080;display:flex;align-items:center;justify-content:center;transition:transform .15s ease,background .15s ease}.bubble-btn[_ngcontent-%COMP%]:hover{transform:scale(1.08);background:var(--cancel-button-color-2)}.bubble-btn.has-pending[_ngcontent-%COMP%]{background:var(--confirm-button-color-1);border-color:#a3c73a}.bubble-btn[_ngcontent-%COMP%]   .bubble-icon[_ngcontent-%COMP%]{font-style:normal}.bubble-btn[_ngcontent-%COMP%]   .bubble-badge[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;background:var(--secondary-color);color:var(--font-color-dark);font-size:1rem;font-weight:700;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid var(--primary-color)}.bubble-panel[_ngcontent-%COMP%]{background:var(--container-color);border:2px solid var(--secondary-color);border-radius:12px;padding:1rem;width:220px;box-shadow:0 4px 20px #0009;color:var(--font-color)}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-weight:700;font-size:1rem;margin-bottom:.75rem;border-bottom:1px solid rgba(255,255,255,.15);padding-bottom:.5rem}.panel-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--font-color);cursor:pointer;font-size:.9rem;opacity:.7}.panel-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{opacity:1}.panel-hint[_ngcontent-%COMP%]{font-size:.8rem;opacity:.8;margin:0 0 .6rem}.locked-hint[_ngcontent-%COMP%]{font-size:.8rem;line-height:1.4;opacity:.7;text-align:center;margin-top:.5rem}.char-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.4rem;max-height:240px;overflow-y:auto}.char-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem;background:#ffffff12;border:1px solid rgba(255,255,255,.15);border-radius:8px;padding:.4rem .6rem;color:var(--font-color);cursor:pointer;font-size:.82rem;text-transform:capitalize;transition:background .12s}.char-btn[_ngcontent-%COMP%]:hover{background:#ffffff26}.selected-char[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;background:#ffffff0d;border-radius:8px;padding:.35rem .5rem}.selected-char[_ngcontent-%COMP%]   .char-name[_ngcontent-%COMP%]{flex:1;font-size:.82rem;text-transform:capitalize}.selected-char[_ngcontent-%COMP%]   .change-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--font-color);cursor:pointer;font-size:1rem;opacity:.6}.selected-char[_ngcontent-%COMP%]   .change-btn[_ngcontent-%COMP%]:hover{opacity:1}.char-thumb[_ngcontent-%COMP%], .char-thumb-sm[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;border:1px solid var(--secondary-color)}.char-thumb-sm[_ngcontent-%COMP%]{width:28px;height:28px}.initiative-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.5rem}.initiative-row[_ngcontent-%COMP%]   .initiative-input[_ngcontent-%COMP%]{width:56px;text-align:center;font-size:1.3rem;font-weight:700;border:2px solid var(--secondary-color);border-radius:6px;background:#0000004d;color:var(--font-color);padding:.25rem}.initiative-row[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{flex:1;background:var(--confirm-button-color-1);border:none;border-radius:6px;color:var(--font-color);font-size:.85rem;font-weight:700;cursor:pointer;padding:.3rem .5rem;transition:background .12s}.initiative-row[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]:hover{background:var(--confirm-button-color-2)}.submitted-label[_ngcontent-%COMP%]{font-size:.78rem;color:#a3c73a;margin:0}.submitted-label[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{opacity:.6;font-size:.72rem}"]})}return i})();function Ht(i,c){1&i&&e.nrm(0,"app-element",6),2&i&&e.Y8G("element",c.$implicit)}function zt(i,c){1&i&&e.nrm(0,"app-attack-modal")}function Jt(i,c){1&i&&e.nrm(0,"app-add-monster")}let Qt=(()=>{class i{appContext;elements=[{type:u.RJ.Fire,state:u.e_.None},{type:u.RJ.Ice,state:u.e_.None},{type:u.RJ.Earth,state:u.e_.None},{type:u.RJ.Air,state:u.e_.None},{type:u.RJ.Light,state:u.e_.None},{type:u.RJ.Dark,state:u.e_.None}];constructor(t){this.appContext=t}static \u0275fac=function(o){return new(o||i)(e.rXU(C.B))};static \u0275cmp=e.VBU({type:i,selectors:[["app-scenario"]],decls:15,vars:3,consts:[[1,"scenario-container"],[1,"content"],[1,"elements-row"],[3,"element",4,"ngFor","ngForOf"],[1,"connection-status"],[4,"ngIf"],[3,"element"]],template:function(o,n){1&o&&(e.j41(0,"div",0),e.nrm(1,"app-setup"),e.j41(2,"div",1)(3,"div",2),e.DNE(4,Ht,1,1,"app-element",3),e.k0s(),e.nrm(5,"app-round")(6,"app-connection-status",4),e.k0s(),e.nrm(7,"app-game"),e.DNE(8,zt,1,0,"app-attack-modal",5)(9,Jt,1,0,"app-add-monster",5),e.nrm(10,"app-scenario-general-reference")(11,"app-scenario-monster-reference")(12,"app-loot")(13,"app-log")(14,"app-initiative-bubble"),e.k0s()),2&o&&(e.R7$(4),e.Y8G("ngForOf",n.elements),e.R7$(4),e.Y8G("ngIf",n.appContext.selectedCreature),e.R7$(),e.Y8G("ngIf",n.appContext.addMonsterToggled))},dependencies:[p.MD,p.Sq,p.bT,je,Ge,ze,Ve,Je,Re,Ze,Xt,gt,Ct,xt,Ut],styles:[".scenario-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.content[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.content[_ngcontent-%COMP%]   .elements-row[_ngcontent-%COMP%]{display:flex;gap:10px}.content[_ngcontent-%COMP%]   .connection-status[_ngcontent-%COMP%]{margin-left:auto}@media (max-width: 768px){.content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;align-items:stretch}.content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{min-width:0}.content[_ngcontent-%COMP%]   app-round[_ngcontent-%COMP%]{display:block;width:100%;justify-self:stretch}.elements-row[_ngcontent-%COMP%]{grid-column:1/-1}}"]})}return i})()},7556:(K,w,m)=>{m.d(w,{S:()=>x});var p=m(3664);let x=(()=>{class b{el;previousValue="";constructor(u){this.el=u}onFocus(){this.previousValue=this.el.nativeElement.value,this.el.nativeElement.value=""}onBlur(){""===this.el.nativeElement.value&&(this.el.nativeElement.value=this.previousValue,this.el.nativeElement.dispatchEvent(new Event("input",{bubbles:!0})))}static \u0275fac=function(v){return new(v||b)(p.rXU(p.aKT))};static \u0275dir=p.FsC({type:b,selectors:[["input","type","tel"]],hostBindings:function(v,e){1&v&&p.bIt("focus",function(){return e.onFocus()})("blur",function(){return e.onBlur()})}})}return b})()}}]);